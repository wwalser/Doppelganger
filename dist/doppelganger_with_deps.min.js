(function(t){t.MakeArg=function(){var e=function(){return e.get.apply(t,arguments)};return e.version="1.0.1",e.parse=function(t){if(!t)return{};if(-1===t.indexOf("=")&&-1===t.indexOf("&"))return{};t=e._cleanParamStr(t);var r={},a=t.split("&");for(var n in a){var i=a[n].split("="),o=decodeURIComponent(i[0]),s=decodeURIComponent(i[1]);e._access(r,o,s)}return r},e._access=function(t,r,a){var n=a!==void 0,i=-1,o={"true":!0,"false":!1,"null":null};if(("string"==typeof r||"[object String]"==toString.call(r))&&(i=r.search(/[\.\[]/)),-1===i)return e.coerceMode&&(a=a&&!isNaN(a)?+a:"undefined"===a?void 0:void 0!==o[a]?o[a]:a),n?t[r]=a:t[r];var s=r.substr(0,i),u=r.substr(i+1);switch(r.charAt(i)){case"[":return t[s]=t[s]||[],u=u.replace("]",""),-1===u.search(/[\.\[]/)&&(u=parseInt(u,10)),e._access(t[s],u,a);case".":return t[s]=t[s]||{},e._access(t[s],u,a)}return t},e.stringify=function(t,r){switch(typeof t){case"object":var a,n=[];for(var i in t)if(t.hasOwnProperty(i)){var o=t[i];void 0!==i&&0!==i.length&&void 0!==o&&(a=r?r+"."+i:i,t.length!==void 0&&(a=r?r+"["+i+"]":i),"object"==typeof o?n.push(e.stringify(o,a)):n.push(encodeURIComponent(a)+"="+encodeURIComponent(o)))}return n.join("&")}return encodeURIComponent(t)},e.url=function(){var t=e.urlUseHash?e.hashQuerySeperator:e.querySeperator,r=[location.pathname,t],a={};switch(arguments.length){case 1:r.push(e.stringify(arguments[0]));break;case 2:r[0]=e._cleanPath(arguments[0]),a=e.parse(arguments[0]),a=e.merge(a,arguments[1]),r.push(e.stringify(a));break;case 3:r[0]=e._cleanPath(arguments[0]),r[1]=e.querySeperator,r.push(e.stringify(arguments[1])),"string"==typeof arguments[2]?r.push(e.hashSeperator):r.push(e.hashQuerySeperator),r.push(e.stringify(arguments[2]))}var n=r.join("");return n.indexOf(t)==n.length-t.length&&(n=n.substr(0,n.length-t.length)),n},e.urlUseHash=!1,e.querySeperator="?",e.hashSeperator="#",e.hashQuerySeperator="#?",e.coerceMode=!0,e.all=function(){var t=e.parse(e.querystring()+"&"+e.hashstring());return e._all?e._all:e._all=t},e.get=function(t,r){var a=e._access(e.all(),t);return a===void 0?r:a},e.query=function(){return e._query?e._query:e._query=e.parse(e.querystring())},e.hash=function(){return e._hash?e._hash:e._hash=e.parse(e.hashstring())},e.querystring=function(){return e._cleanParamStr(location.search)},e.hashstring=function(){return e._cleanParamStr(location.hash)},e._cleanParamStr=function(t){if(t.indexOf(e.querySeperator)>-1&&(t=t.split(e.querySeperator)[1]),t.indexOf(e.hashSeperator)>-1&&(t=t.split(e.hashSeperator)[1]),-1===t.indexOf("=")&&-1===t.indexOf("&"))return"";for(;0==t.indexOf(e.hashSeperator)||0==t.indexOf(e.querySeperator);)t=t.substr(1);return t},e._cleanPath=function(t){return t.indexOf(e.querySeperator)>-1&&(t=t.substr(0,t.indexOf(e.querySeperator))),t.indexOf(e.hashSeperator)>-1&&(t=t.substr(0,t.indexOf(e.hashSeperator))),t},e.merge=function(){var t={};for(var e in arguments)for(var r in arguments[e])t[r]=arguments[e][r];return t},e},t.Arg=MakeArg()})(window),function(t,e){"use strict";var r=t.History=t.History||{};if(r.Adapter!==void 0)throw Error("History.js Adapter has already been loaded...");r.Adapter={handlers:{},_uid:1,uid:function(t){return t._uid||(t._uid=r.Adapter._uid++)},bind:function(t,e,a){var n=r.Adapter.uid(t);r.Adapter.handlers[n]=r.Adapter.handlers[n]||{},r.Adapter.handlers[n][e]=r.Adapter.handlers[n][e]||[],r.Adapter.handlers[n][e].push(a),t["on"+e]=function(t,e){return function(a){r.Adapter.trigger(t,e,a)}}(t,e)},trigger:function(t,e,a){a=a||{};var n,i,o=r.Adapter.uid(t);for(r.Adapter.handlers[o]=r.Adapter.handlers[o]||{},r.Adapter.handlers[o][e]=r.Adapter.handlers[o][e]||[],n=0,i=r.Adapter.handlers[o][e].length;i>n;++n)r.Adapter.handlers[o][e][n].apply(this,[a])},extractEventData:function(t,r){var a=r&&r[t]||e;return a},onDomLoad:function(e){var r=t.setTimeout(function(){e()},2e3);t.onload=function(){clearTimeout(r),e()}}},r.init!==void 0&&r.init()}(window),function(t,e){"use strict";var r=t.console||e,a=t.document,n=t.navigator,i=!1,o=t.setTimeout,s=t.clearTimeout,u=t.setInterval,l=t.clearInterval,h=t.JSON,c=t.alert,d=t.History=t.History||{},p=t.history;try{i=t.sessionStorage,i.setItem("TEST","1"),i.removeItem("TEST")}catch(f){i=!1}if(h.stringify=h.stringify||h.encode,h.parse=h.parse||h.decode,d.init!==void 0)throw Error("History.js Core has already been loaded...");d.init=function(){return d.Adapter===void 0?!1:(d.initCore!==void 0&&d.initCore(),d.initHtml4!==void 0&&d.initHtml4(),!0)},d.initCore=function(){if(d.initCore.initialized!==void 0)return!1;if(d.initCore.initialized=!0,d.options=d.options||{},d.options.hashChangeInterval=d.options.hashChangeInterval||100,d.options.safariPollInterval=d.options.safariPollInterval||500,d.options.doubleCheckInterval=d.options.doubleCheckInterval||500,d.options.disableSuid=d.options.disableSuid||!1,d.options.storeInterval=d.options.storeInterval||1e3,d.options.busyDelay=d.options.busyDelay||250,d.options.debug=d.options.debug||!1,d.options.initialTitle=d.options.initialTitle||a.title,d.options.html4Mode=d.options.html4Mode||!1,d.options.delayInit=d.options.delayInit||!1,d.intervalList=[],d.clearAllIntervals=function(){var t,e=d.intervalList;if(e!==void 0&&null!==e){for(t=0;e.length>t;t++)l(e[t]);d.intervalList=null}},d.debug=function(){(d.options.debug||!1)&&d.log.apply(d,arguments)},d.log=function(){var t,e,n,i,o,s=r!==void 0&&r.log!==void 0&&r.log.apply!==void 0,u=a.getElementById("log");for(s?(i=Array.prototype.slice.call(arguments),t=i.shift(),r.debug!==void 0?r.debug.apply(r,[t,i]):r.log.apply(r,[t,i])):t="\n"+arguments[0]+"\n",e=1,n=arguments.length;n>e;++e){if(o=arguments[e],"object"==typeof o&&h!==void 0)try{o=h.stringify(o)}catch(l){}t+="\n"+o+"\n"}return u?(u.value+=t+"\n-----\n",u.scrollTop=u.scrollHeight-u.clientHeight):s||c(t),!0},d.getInternetExplorerMajorVersion=function(){var t=d.getInternetExplorerMajorVersion.cached=d.getInternetExplorerMajorVersion.cached!==void 0?d.getInternetExplorerMajorVersion.cached:function(){for(var t=3,e=a.createElement("div"),r=e.getElementsByTagName("i");(e.innerHTML="<!--[if gt IE "+ ++t+"]><i></i><![endif]-->")&&r[0];);return t>4?t:!1}();return t},d.isInternetExplorer=function(){var t=d.isInternetExplorer.cached=d.isInternetExplorer.cached!==void 0?d.isInternetExplorer.cached:Boolean(d.getInternetExplorerMajorVersion());return t},d.emulated=d.options.html4Mode?{pushState:!0,hashChange:!0}:{pushState:!Boolean(t.history&&t.history.pushState&&t.history.replaceState&&!/ Mobile\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i.test(n.userAgent)&&!/AppleWebKit\/5([0-2]|3[0-2])/i.test(n.userAgent)),hashChange:Boolean(!("onhashchange"in t||"onhashchange"in a)||d.isInternetExplorer()&&8>d.getInternetExplorerMajorVersion())},d.enabled=!d.emulated.pushState,d.bugs={setHash:Boolean(!d.emulated.pushState&&"Apple Computer, Inc."===n.vendor&&/AppleWebKit\/5([0-2]|3[0-3])/.test(n.userAgent)),safariPoll:Boolean(!d.emulated.pushState&&"Apple Computer, Inc."===n.vendor&&/AppleWebKit\/5([0-2]|3[0-3])/.test(n.userAgent)),ieDoubleCheck:Boolean(d.isInternetExplorer()&&8>d.getInternetExplorerMajorVersion()),hashEscape:Boolean(d.isInternetExplorer()&&7>d.getInternetExplorerMajorVersion())},d.isEmptyObject=function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},d.cloneObject=function(t){var e,r;return t?(e=h.stringify(t),r=h.parse(e)):r={},r},d.getRootUrl=function(){var t=a.location.protocol+"//"+(a.location.hostname||a.location.host);return a.location.port&&(t+=":"+a.location.port),t+="/"},d.getBaseHref=function(){var t=a.getElementsByTagName("base"),e=null,r="";return 1===t.length&&(e=t[0],r=e.href.replace(/[^\/]+$/,"")),r=r.replace(/\/+$/,""),r&&(r+="/"),r},d.getBaseUrl=function(){var t=d.getBaseHref()||d.getBasePageUrl()||d.getRootUrl();return t},d.getPageUrl=function(){var t,e=d.getState(!1,!1),r=(e||{}).url||d.getLocationHref();return t=r.replace(/\/+$/,"").replace(/[^\/]+$/,function(t){return/\./.test(t)?t:t+"/"})},d.getBasePageUrl=function(){var t=d.getLocationHref().replace(/[#\?].*/,"").replace(/[^\/]+$/,function(t){return/[^\/]$/.test(t)?"":t}).replace(/\/+$/,"")+"/";return t},d.getFullUrl=function(t,e){var r=t,a=t.substring(0,1);return e=e===void 0?!0:e,/[a-z]+\:\/\//.test(t)||(r="/"===a?d.getRootUrl()+t.replace(/^\/+/,""):"#"===a?d.getPageUrl().replace(/#.*/,"")+t:"?"===a?d.getPageUrl().replace(/[\?#].*/,"")+t:e?d.getBaseUrl()+t.replace(/^(\.\/)+/,""):d.getBasePageUrl()+t.replace(/^(\.\/)+/,"")),r.replace(/\#$/,"")},d.getShortUrl=function(t){var e=t,r=d.getBaseUrl(),a=d.getRootUrl();return d.emulated.pushState&&(e=e.replace(r,"")),e=e.replace(a,"/"),d.isTraditionalAnchor(e)&&(e="./"+e),e=e.replace(/^(\.\/)+/g,"./").replace(/\#$/,"")},d.getLocationHref=function(t){return t=t||a,t.URL===t.location.href?t.location.href:t.location.href===decodeURIComponent(t.URL)?t.URL:t.location.hash&&decodeURIComponent(t.location.href.replace(/^[^#]+/,""))===t.location.hash?t.location.href:-1==t.URL.indexOf("#")&&-1!=t.location.href.indexOf("#")?t.location.href:t.URL||t.location.href},d.store={},d.idToState=d.idToState||{},d.stateToId=d.stateToId||{},d.urlToId=d.urlToId||{},d.storedStates=d.storedStates||[],d.savedStates=d.savedStates||[],d.normalizeStore=function(){d.store.idToState=d.store.idToState||{},d.store.urlToId=d.store.urlToId||{},d.store.stateToId=d.store.stateToId||{}},d.getState=function(t,e){t===void 0&&(t=!0),e===void 0&&(e=!0);var r=d.getLastSavedState();return!r&&e&&(r=d.createStateObject()),t&&(r=d.cloneObject(r),r.url=r.cleanUrl||r.url),r},d.getIdByState=function(t){var e,r=d.extractId(t.url);if(!r)if(e=d.getStateString(t),d.stateToId[e]!==void 0)r=d.stateToId[e];else if(d.store.stateToId[e]!==void 0)r=d.store.stateToId[e];else{for(;r=(new Date).getTime()+(Math.random()+"").replace(/\D/g,""),d.idToState[r]!==void 0||d.store.idToState[r]!==void 0;);d.stateToId[e]=r,d.idToState[r]=t}return r},d.normalizeState=function(t){var e,r;return t&&"object"==typeof t||(t={}),t.normalized!==void 0?t:(t.data&&"object"==typeof t.data||(t.data={}),e={},e.normalized=!0,e.title=t.title||"",e.url=d.getFullUrl(t.url?t.url:d.getLocationHref()),e.hash=d.getShortUrl(e.url),e.data=d.cloneObject(t.data),e.id=d.getIdByState(e),e.cleanUrl=e.url.replace(/\??\&_suid.*/,""),e.url=e.cleanUrl,r=!d.isEmptyObject(e.data),(e.title||r)&&d.options.disableSuid!==!0&&(e.hash=d.getShortUrl(e.url).replace(/\??\&_suid.*/,""),/\?/.test(e.hash)||(e.hash+="?"),e.hash+="&_suid="+e.id),e.hashedUrl=d.getFullUrl(e.hash),(d.emulated.pushState||d.bugs.safariPoll)&&d.hasUrlDuplicate(e)&&(e.url=e.hashedUrl),e)},d.createStateObject=function(t,e,r){var a={data:t,title:e,url:r};return a=d.normalizeState(a)},d.getStateById=function(t){t+="";var r=d.idToState[t]||d.store.idToState[t]||e;return r},d.getStateString=function(t){var e,r,a;return e=d.normalizeState(t),r={data:e.data,title:t.title,url:t.url},a=h.stringify(r)},d.getStateId=function(t){var e,r;return e=d.normalizeState(t),r=e.id},d.getHashByState=function(t){var e,r;return e=d.normalizeState(t),r=e.hash},d.extractId=function(t){var e,r,a,n;return n=-1!=t.indexOf("#")?t.split("#")[0]:t,r=/(.*)\&_suid=([0-9]+)$/.exec(n),a=r?r[1]||t:t,e=r?(r[2]||"")+"":"",e||!1},d.isTraditionalAnchor=function(t){var e=!/[\/\?\.]/.test(t);return e},d.extractState=function(t,e){var r,a,n=null;return e=e||!1,r=d.extractId(t),r&&(n=d.getStateById(r)),n||(a=d.getFullUrl(t),r=d.getIdByUrl(a)||!1,r&&(n=d.getStateById(r)),!n&&e&&!d.isTraditionalAnchor(t)&&(n=d.createStateObject(null,null,a))),n},d.getIdByUrl=function(t){var r=d.urlToId[t]||d.store.urlToId[t]||e;return r},d.getLastSavedState=function(){return d.savedStates[d.savedStates.length-1]||e},d.getLastStoredState=function(){return d.storedStates[d.storedStates.length-1]||e},d.hasUrlDuplicate=function(t){var e,r=!1;return e=d.extractState(t.url),r=e&&e.id!==t.id},d.storeState=function(t){return d.urlToId[t.url]=t.id,d.storedStates.push(d.cloneObject(t)),t},d.isLastSavedState=function(t){var e,r,a,n=!1;return d.savedStates.length&&(e=t.id,r=d.getLastSavedState(),a=r.id,n=e===a),n},d.saveState=function(t){return d.isLastSavedState(t)?!1:(d.savedStates.push(d.cloneObject(t)),!0)},d.getStateByIndex=function(t){var e=null;return e=t===void 0?d.savedStates[d.savedStates.length-1]:0>t?d.savedStates[d.savedStates.length+t]:d.savedStates[t]},d.getCurrentIndex=function(){var t=null;return t=1>d.savedStates.length?0:d.savedStates.length-1},d.getHash=function(t){var e,r=d.getLocationHref(t);return e=d.getHashByUrl(r)},d.unescapeHash=function(t){var e=d.normalizeHash(t);return e=decodeURIComponent(e)},d.normalizeHash=function(t){var e=t.replace(/[^#]*#/,"").replace(/#.*/,"");return e},d.setHash=function(t,e){var r,n;return e!==!1&&d.busy()?(d.pushQueue({scope:d,callback:d.setHash,args:arguments,queue:e}),!1):(d.busy(!0),r=d.extractState(t,!0),r&&!d.emulated.pushState?d.pushState(r.data,r.title,r.url,!1):d.getHash()!==t&&(d.bugs.setHash?(n=d.getPageUrl(),d.pushState(null,null,n+"#"+t,!1)):a.location.hash=t),d)},d.escapeHash=function(e){var r=d.normalizeHash(e);return r=t.encodeURIComponent(r),d.bugs.hashEscape||(r=r.replace(/\%21/g,"!").replace(/\%26/g,"&").replace(/\%3D/g,"=").replace(/\%3F/g,"?")),r},d.getHashByUrl=function(t){var e=(t+"").replace(/([^#]*)#?([^#]*)#?(.*)/,"$2");return e=d.unescapeHash(e)},d.setTitle=function(t){var e,r=t.title;r||(e=d.getStateByIndex(0),e&&e.url===t.url&&(r=e.title||d.options.initialTitle));try{a.getElementsByTagName("title")[0].innerHTML=r.replace("<","&lt;").replace(">","&gt;").replace(" & "," &amp; ")}catch(n){}return a.title=r,d},d.queues=[],d.busy=function(t){if(t!==void 0?d.busy.flag=t:d.busy.flag===void 0&&(d.busy.flag=!1),!d.busy.flag){s(d.busy.timeout);var e=function(){var t,r,a;if(!d.busy.flag)for(t=d.queues.length-1;t>=0;--t)r=d.queues[t],0!==r.length&&(a=r.shift(),d.fireQueueItem(a),d.busy.timeout=o(e,d.options.busyDelay))};d.busy.timeout=o(e,d.options.busyDelay)}return d.busy.flag},d.busy.flag=!1,d.fireQueueItem=function(t){return t.callback.apply(t.scope||d,t.args||[])},d.pushQueue=function(t){return d.queues[t.queue||0]=d.queues[t.queue||0]||[],d.queues[t.queue||0].push(t),d},d.queue=function(t,e){return"function"==typeof t&&(t={callback:t}),e!==void 0&&(t.queue=e),d.busy()?d.pushQueue(t):d.fireQueueItem(t),d},d.clearQueue=function(){return d.busy.flag=!1,d.queues=[],d},d.stateChanged=!1,d.doubleChecker=!1,d.doubleCheckComplete=function(){return d.stateChanged=!0,d.doubleCheckClear(),d},d.doubleCheckClear=function(){return d.doubleChecker&&(s(d.doubleChecker),d.doubleChecker=!1),d},d.doubleCheck=function(t){return d.stateChanged=!1,d.doubleCheckClear(),d.bugs.ieDoubleCheck&&(d.doubleChecker=o(function(){return d.doubleCheckClear(),d.stateChanged||t(),!0},d.options.doubleCheckInterval)),d},d.safariStatePoll=function(){var e,r=d.extractState(d.getLocationHref());return d.isLastSavedState(r)?void 0:(e=r,e||(e=d.createStateObject()),d.Adapter.trigger(t,"popstate"),d)},d.back=function(t){return t!==!1&&d.busy()?(d.pushQueue({scope:d,callback:d.back,args:arguments,queue:t}),!1):(d.busy(!0),d.doubleCheck(function(){d.back(!1)}),p.go(-1),!0)},d.forward=function(t){return t!==!1&&d.busy()?(d.pushQueue({scope:d,callback:d.forward,args:arguments,queue:t}),!1):(d.busy(!0),d.doubleCheck(function(){d.forward(!1)}),p.go(1),!0)},d.go=function(t,e){var r;if(t>0)for(r=1;t>=r;++r)d.forward(e);else{if(!(0>t))throw Error("History.go: History.go requires a positive or negative integer passed.");for(r=-1;r>=t;--r)d.back(e)}return d},d.emulated.pushState){var f=function(){};d.pushState=d.pushState||f,d.replaceState=d.replaceState||f}else d.onPopState=function(e,r){var a,n,i=!1,o=!1;return d.doubleCheckComplete(),a=d.getHash(),a?(n=d.extractState(a||d.getLocationHref(),!0),n?d.replaceState(n.data,n.title,n.url,!1):(d.Adapter.trigger(t,"anchorchange"),d.busy(!1)),d.expectedStateId=!1,!1):(i=d.Adapter.extractEventData("state",e,r)||!1,o=i?d.getStateById(i):d.expectedStateId?d.getStateById(d.expectedStateId):d.extractState(d.getLocationHref()),o||(o=d.createStateObject(null,null,d.getLocationHref())),d.expectedStateId=!1,d.isLastSavedState(o)?(d.busy(!1),!1):(d.storeState(o),d.saveState(o),d.setTitle(o),d.Adapter.trigger(t,"statechange"),d.busy(!1),!0))},d.Adapter.bind(t,"popstate",d.onPopState),d.pushState=function(e,r,a,n){if(d.getHashByUrl(a)&&d.emulated.pushState)throw Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(n!==!1&&d.busy())return d.pushQueue({scope:d,callback:d.pushState,args:arguments,queue:n}),!1;d.busy(!0);var i=d.createStateObject(e,r,a);return d.isLastSavedState(i)?d.busy(!1):(d.storeState(i),d.expectedStateId=i.id,p.pushState(i.id,i.title,i.url),d.Adapter.trigger(t,"popstate")),!0},d.replaceState=function(e,r,a,n){if(d.getHashByUrl(a)&&d.emulated.pushState)throw Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(n!==!1&&d.busy())return d.pushQueue({scope:d,callback:d.replaceState,args:arguments,queue:n}),!1;d.busy(!0);var i=d.createStateObject(e,r,a);return d.isLastSavedState(i)?d.busy(!1):(d.storeState(i),d.expectedStateId=i.id,p.replaceState(i.id,i.title,i.url),d.Adapter.trigger(t,"popstate")),!0};if(i){try{d.store=h.parse(i.getItem("History.store"))||{}}catch(g){d.store={}}d.normalizeStore()}else d.store={},d.normalizeStore();d.Adapter.bind(t,"unload",d.clearAllIntervals),d.saveState(d.storeState(d.extractState(d.getLocationHref(),!0))),i&&(d.onUnload=function(){var t,e,r;try{t=h.parse(i.getItem("History.store"))||{}}catch(a){t={}}t.idToState=t.idToState||{},t.urlToId=t.urlToId||{},t.stateToId=t.stateToId||{};for(e in d.idToState)d.idToState.hasOwnProperty(e)&&(t.idToState[e]=d.idToState[e]);for(e in d.urlToId)d.urlToId.hasOwnProperty(e)&&(t.urlToId[e]=d.urlToId[e]);for(e in d.stateToId)d.stateToId.hasOwnProperty(e)&&(t.stateToId[e]=d.stateToId[e]);d.store=t,d.normalizeStore(),r=h.stringify(t);try{i.setItem("History.store",r)}catch(n){if(n.code!==DOMException.QUOTA_EXCEEDED_ERR)throw n;i.length&&(i.removeItem("History.store"),i.setItem("History.store",r))}},d.intervalList.push(u(d.onUnload,d.options.storeInterval)),d.Adapter.bind(t,"beforeunload",d.onUnload),d.Adapter.bind(t,"unload",d.onUnload)),d.emulated.pushState||(d.bugs.safariPoll&&d.intervalList.push(u(d.safariStatePoll,d.options.safariPollInterval)),("Apple Computer, Inc."===n.vendor||"Mozilla"===(n.appCodeName||""))&&(d.Adapter.bind(t,"hashchange",function(){d.Adapter.trigger(t,"popstate")}),d.getHash()&&d.Adapter.onDomLoad(function(){d.Adapter.trigger(t,"hashchange")})))},(!d.options||!d.options.delayInit)&&d.init()}(window),Array.prototype.indexOf||(Array.prototype.indexOf=function(t){"use strict";if(void 0===this||null===this)throw new TypeError;var e=Object(this),r=e.length>>>0;if(0===r)return-1;var a=0;if(arguments.length>0&&(a=Number(arguments[1]),a!==a?a=0:0!==a&&a!==1/0&&a!==-(1/0)&&(a=(a>0||-1)*Math.floor(Math.abs(a)))),a>=r)return-1;for(var n=a>=0?a:Math.max(r-Math.abs(a),0);r>n;n++)if(n in e&&e[n]===t)return n;return-1}),RegExp.escape=function(t){if(!arguments.callee.sRE){var e=["/",".","*","+","?","|","(",")","[","]","{","}","\\"];arguments.callee.sRE=RegExp("(\\"+e.join("|\\")+")","g")}return t.replace(arguments.callee.sRE,"\\$1")},Sherpa={Router:function(t){this.routes={},this.root=new Sherpa.Node,this.requestKeys=t&&t.requestKeys||["method"]},Path:function(t,e){this.route=t;var r=this.pathSplit(e);this.compiledUri=[];for(var a=0;a!=r.length;a++)":"==r[a].substring(0,1)?this.compiledUri.push("params['"+r[a].substring(1)+"']"):this.compiledUri.push("'"+r[a]+"'");this.compiledUri=this.compiledUri.join("+"),this.groups=[];for(var n=0;r.length>n;n++){var i=r[n];"/"==i?this.groups.push([]):""!=i&&this.groups[this.groups.length-1].push(i)}},Route:function(t,e){this.router=t,this.requestConditions={},this.matchingConditions={},this.variableNames=[];for(var r=[""],a=e.split(""),n=0,i=1,o=0;a.length>o;o++){var s=a[o];if("("==s){for(var u=n;u!=i;u++)r.push(r[u]);n=i,i=r.length}else if(")"==s)n-=i-n;else for(var l=n;l!=i;l++)r[l]+=s}this.partial=!1,this.paths=[];for(var h=0;h!=r.length;h++)this.paths.push(new Sherpa.Path(this,r[h]))},Node:function(){this.reset()},Response:function(t,e){this.path=t,this.route=t.route,this.paramsArray=e,this.destination=this.route.destination,this.params={};for(var r=0;r!=this.path.variableNames.length;r++)this.params[this.path.variableNames[r]]=this.paramsArray[r]}},Sherpa.Node.prototype={reset:function(){this.linear=[],this.lookup={},this.catchall=null},dup:function(){for(var t=new Sherpa.Node,e=0;e!=this.linear.length;e++)t.linear.push(this.linear[e]);for(var r in this.lookup)t.lookup[r]=this.lookup[r];return t.catchall=this.catchall,t},addLinear:function(t,e){var r=new Sherpa.Node;return this.linear.push([t,e,r]),r},addCatchall:function(){return this.catchall||(this.catchall=new Sherpa.Node),this.catchall},addLookup:function(t){return this.lookup[t]||(this.lookup[t]=new Sherpa.Node),this.lookup[t]},addRequestNode:function(){return this.requestNode||(this.requestNode=new Sherpa.Node,this.requestNode.requestMethod=null),this.requestNode},find:function(t,e,r){if(this.requestNode||this.destination&&this.destination.route.partial){var a=this;if(a.requestNode&&(a=a.requestNode.findRequest(e)),a&&a.destination&&a.destination.route.partial)return new Sherpa.Response(a.destination,r)}if(0==t.length){var a=this;return this.requestNode&&(a=this.requestNode.findRequest(e)),a&&a.destination?new Sherpa.Response(a.destination,r):void 0}if(0!=this.linear.length)for(var n=t.join("/"),i=0;i!=this.linear.length;i++){var o=this.linear[i],s=o[0].exec(n);if(s){var u=[];if(void 0===s[1])u.push(s[0]);else for(var l=1;o[1]+1>=l;l++)u.push(s[l]);var h=r.concat(u);matchedIndex=s.shift().length;var c=n.substring(matchedIndex).split("/");1==c.length&&""==c[0]&&c.shift();var d=o[2].find(c,e,h);if(d)return d}}if(this.lookup[t[0]]){var d=this.lookup[t[0]].find(t.slice(1,t.length),e,r);if(d)return d}if(this.catchall){var p=t.shift();return r.push(p),this.catchall.find(t,e,r)}return void 0},findRequest:function(t){if(!this.requestMethod)return this.destination?this:void 0;if(0!=this.linear.length&&t[this.requestMethod])for(var e=0;e!=this.linear.length;e++){var r=this.linear[e],a=r[0].exec(t[this.requestMethod]);if(a){matchedIndex=a.shift().length;var n=r[2].findRequest(t);if(n)return n}}if(t[this.requestMethod]&&this.lookup[t[this.requestMethod]]){var n=this.lookup[t[this.requestMethod]].findRequest(t);if(n)return n}return this.catchall?this.catchall.findRequest(t):void 0},transplantValue:function(){if(this.destination&&this.requestNode){for(var t=this.requestNode;t.requestMethod;)t=t.addCatchall();t.destination=this.destination,this.destination=void 0}},compileRequestConditions:function(t,e){var r=[this],a=t.requestKeys;for(var n in a){var i=a[n];if(e[i]){1==r.length&&r[0]===this&&(r=[this.addRequestNode()]);for(var o=0;o!=r.length;o++){var s=r[o];s.requestMethod||(s.requestMethod=i);var u=a.indexOf(i),l=a.indexOf(s.requestMethod);if(u==l)r[o]=e[i].compile?r[o].addLinear(e[i],0):r[o].addLookup(e[i]);else if(l>u)r[o]=r[o].addCatchall();else{var h=s.dup();s.reset(),s.requestMethod=i,s.catchall=h,o--}}}else for(var o=0;o!=r.length;o++){var c=r[o];!c.requestMethod&&c.requestNode&&(c=c.requestNode),c.requestMethod&&(r[o]=c.addCatchall(),r[o].requestMethod=null)}}return this.transplantValue(),r}},Sherpa.Router.prototype={generate:function(t,e){return this.routes[t].generate(e)},add:function(t,e){var r=new Sherpa.Route(this,t);return e&&r.withOptions(e),r},recognize:function(t,e){return"/"==t.substring(0,1)&&(t=t.substring(1)),this.root.find(""==t?[]:t.split(/\//),e,[])}},Sherpa.Route.prototype={withOptions:function(t){return t.conditions&&this.condition(t.conditions),t.matchesWith&&this.matchesWith(t.matchesWith),t.matchPartially&&this.matchPartially(t.matchPartially),t.name&&this.matchPartially(t.name),this},name:function(t){return this.router.routes[t]=this,this},matchPartially:function(t){return this.partial=void 0===t||t===!0,this},matchesWith:function(t){for(var e in t)this.matchingConditions[e]=t[e];return this},compile:function(){for(var t=0;t!=this.paths.length;t++){this.paths[t].compile();for(var e=0;e!=this.paths[t].variableNames.length;e++)-1==this.variableNames.indexOf(this.paths[t].variableNames[e])&&this.variableNames.push(this.paths[t].variableNames[e])}},to:function(t){return this.compile(),this.destination=t,this},condition:function(t){for(var e in t)this.requestConditions[e]=t[e];return this},generate:function(t){var e=void 0;if(void 0==t||1==this.paths.length)e=this.paths[0].generate(t);else for(var r=this.paths.length-1;r>=0&&!(e=this.paths[r].generate(t));r--);if(e){e=encodeURI(e);var a="";for(var n in t)a+=(""==a?"?":"&")+encodeURIComponent(n)+"="+encodeURIComponent(t[n]);return e+a}return void 0}},Sherpa.Path.prototype={pathSplit:function(t){var e=[],r=t.split("/");""==r[0]&&r.shift();for(var a=0;a!=r.length;a++){e.push("/"),e.push(""),partChars=r[a].split("");for(var n=!1,i=0;i!=partChars.length;i++)if(n){var o=partChars[i].charCodeAt(0);o>=48&&57>=o||o>=65&&90>=o||o>=97&&122>=o||95==o?e[e.length-1]+=partChars[i]:(n=!1,e.push(partChars[i]))}else":"==partChars[i]?(n=!0,""==e[e.length-1]?e[e.length-1]+=":":e.push(":")):e[e.length-1]+=partChars[i]}return e},generate:function(params){for(var varIdx=0;varIdx!=this.variableNames.length;varIdx++)if(!params[this.variableNames[varIdx]])return void 0;for(var varIdx=0;varIdx!=this.variableNames.length;varIdx++)if(this.route.matchingConditions[this.variableNames[varIdx]]&&this.route.matchingConditions[this.variableNames[varIdx]].exec(""+params[this.variableNames[varIdx]])!=""+params[this.variableNames[varIdx]])return void 0;for(var path=eval(this.compiledUri),varIdx=0;varIdx!=this.variableNames.length;varIdx++)delete params[this.variableNames[varIdx]];return path},compile:function(){this.variableNames=[];for(var t=this.route.router.root,e=0;e!=this.groups.length;e++){var r=this.groups[e];if(r.length>1){for(var a="^",n=0;n!=r.length;n++){var i=r[n],o=0;if(":"==i.substring(0,1)){var s=i.substring(1);this.variableNames.push(s),a+=this.route.matchingConditions[s]?""+this.route.matchingConditions[s]:"(.*?)",o+=1}else a+=RegExp.escape(i)}t=t.addLinear(RegExp(a),o)}else if(1==r.length){var i=r[0];if(":"==i.substring(0,1)){var s=i.substring(1);this.variableNames.push(s),t=this.route.matchingConditions[s]?t.addLinear(RegExp(this.route.matchingConditions[s]),1):t.addCatchall()}else t=t.addLookup(i)}}for(var u=t.compileRequestConditions(this.route.router,this.route.requestConditions),l=0;l!=u.length;l++)u[l].destination=this}},function(t){"use strict";function e(t){var e=[];return t?(o.each(t,function(t,r){var a,n=r.split(" "),i=n[0].split(","),s=n.slice(1).join(" "),l=t;o.each(i,function(r){"statechange"===r?(a=window,t=function(){var t=History.getState().data.query;l(t)},o.addEvent(a,r,t)):(a=u,o.addEvent(a,r,s,t)),e.push({name:r,selector:s,callback:t,elem:a})})}),e):e}function r(t){0!==t.length&&o.each(t,function(t){o.removeEvent(t.elem,t.name,t.selector,t.callback)})}var a;a=function(){this.routes={},this.filters={}},"object"==typeof module&&"object"==typeof module.exports?module.exports=a:t.Doppelganger=a;var n,i,o,s,u=t.document||{},l=Array.prototype,h=l.slice,c=l.isArray,d=l.forEach,p=l.indexOf,f={};a.util=o={getterSetterCreator:function(t){return function(e,r){var a=this[t];return r?(a[e]=r,void 0):a[e]}},extend:function(t){var e,r,a,n=h.call(arguments,1);for(r=0;n.length>r;r++)if(e=n[r])for(a in e)e.hasOwnProperty(a)&&(t[a]=e[a]);return t},each:function(t,e,r){if(null!=t)if(d&&t.forEach===d)t.forEach(e,r);else if(t.length===+t.length){for(var a=0,n=t.length;n>a;a++)if(e.call(r,t[a],a,t)===!1)return}else for(var i in t)if(t.hasOwnProperty(i)&&e(t[i],i,t)===!1)break},isArray:c||function(t){return t&&"object"==typeof t&&"number"==typeof t.length&&"[object Array]"==""+t||!1},indexOf:function(t,e){if(null==t)return-1;var r=0,a=t.length;if(p&&t.indexOf===p)return t.indexOf(e);for(;a>r;r++)if(t[r]===e)return r;return-1},map:function(t,e){var r=-1,a=t?t.length:0,n=Array("number"==typeof a?a:0);if(o.isArray(t))for(;a>++r;)n[r]=e(t[r],r,t);else o.each(t,function(t,a,i){n[++r]=e(t,a,i)});return n},$:function(t){return u.querySelectorAll(t)},matchesSelector:function(t,e){var r,a;if(t.matches)return t.matches(e);if(!t.parentNode){if(t===u)return"document"===e;r=u.createDocumentFragment(),r.appendChild(t)}a=t.parentNode.querySelectorAll(e);for(var n=0,i=a.length;i>n;n++)if(a[n]===t)return!0;return!1},closest:function(t,e){for(var r=t,a=!1;null!=r&&!(a=o.matchesSelector(r,e));)r=r.parentNode;return a},addEvent:function(t,e,r,a){var n=a;if(a=a?function(t){var e=t.target||t.srcElement;o.closest(e,r)&&n.apply(this,arguments)}:r,t.addEventListener)t.addEventListener(e,a,!1);else{if(!t.attachEvent)throw Error("addEvent() was called in a context without event listener support");t.attachEvent("on"+e,a)}f[e]||(f[e]=[]),f[e].push({fn:n,boundFn:a,selector:"string"==typeof r?r:""})},removeEvent:function(t,e,r,a){for(var n,i,o=f[e],s=o?o.length:0,u=0;s>u;u++)if(n=o[u],a===n.fn&&r===n.selector){i=n.boundFn,o.splice(u,1);break}if(i)if(t.removeEventListener)t.removeEventListener(e,i);else{if(!t.detachEvent)throw Error("removeEvent() was called in a context without event listener support");t.detachEvent(e,i)}}},s=o.$;var g={rootUrl:"",routes:[{name:"index",url:""}],filters:["RouterFilter","EventFilter"]},v={routes:"routeManager",filters:"filterManager"};a.create=function(t){var e,r,n=new a;n.options=o.extend({},g,t),n.filterManager=new a.FilterManager(n),n.routeManager=new a.RouteManager(n,n.options.rootUrl);for(var i in v)v.hasOwnProperty(i)&&(e=v[i],r=n.options[i],n[e].add(r));return n},a.prototype={init:function(){var t=this;this.active=!0,History.Adapter.bind(window,"statechange",function(){if(t.active){var e=History.getState();e.data.destination&&!e.data.controllerStateChange?t.trigger(e.data.destination,e.data.params):e.data.destination||t.trigger(t.startPage.destination,t.startPage.params)}}),this.startPage=this.routeManager.recognize(window.location.pathname),this.navigate()},_destroy:function(){this.active=!1},navigate:function(){this.navigate=function(e,r){history.pushState?History.pushState({destination:e,params:r},u.title,this.routeManager.generate(e,r)):t.location=this.routeManager.generate(e,r)},this.startPage?(this.startPage=o.extend({},this.startPage),this.startPage.params=o.extend(this.startPage.params,Arg.all()),this.trigger(this.startPage.destination,this.startPage.params)):this.navigate(this.options.defaultRoute[0],this.options.defaultRoute[1])},trigger:function(t,e){this.filterManager.process({destination:t,params:e})},updateContent:function(t){var e=s(this.PAGE_CONTENT_SELECTOR);return e.append(t)}},a.RouteHandlers={},a.setRouteHandler=o.getterSetterCreator("RouteHandlers"),a.getRouteHandler=o.getterSetterCreator("RouteHandlers"),a.FilterHandlers={},a.setFilterHandler=o.getterSetterCreator("FilterHandlers"),a.getFilterHandler=o.getterSetterCreator("FilterHandlers"),a.RouteManager=i=function(t,e){this.app=t,this.router=new Sherpa.Router,this.baseUrl=e,this.routes=[]},a.RouteManager.prototype={add:function(t){for(var e,r,a,n=t.length,i=0;n>i;i++)e=t[i],r=e.name,a=e.url,this.router.add(this.baseUrl+a,e).to(r).name(r);this.routes=this.routes.concat(t)},recognize:function(t){return this.router.recognize(t)},generate:function(t,e){return this.router.generate(t,o.extend({},e))},trigger:function(t,e){return a.getRouteHandler(t).call(this.app,e)}};var m=0;a.FilterManager=n=function(t){this.filters=[],this.app=t},a.FilterManager.prototype={add:function(t){this.filters=this.filters.concat(t)},remove:function(t){var e=o.indexOf(this.filters,t);e!==!1&&(m>e&&(m-=1),this.filters.splice(e,1))},process:function(t){for(m=0;this.filters.length>m;m++){var e=this.filters[m];t=a.getFilterHandler(e).call(this.app,t)}}},a.setFilterHandler("RouterFilter",function(t){return!t.destination||!t.params,t.destination&&(t=o.extend(t,this.routeManager.trigger(t.destination,t))),t
});var S=[];a.setFilterHandler("EventFilter",function(t){return t.partial||r(S),S=S.concat(e(t.events)),t})}(this);