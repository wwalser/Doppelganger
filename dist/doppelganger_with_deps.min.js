(function(e){e.MakeArg=function(){var t=function(){return t.get.apply(e,arguments)};return t.version="1.0.1",t.parse=function(e){if(!e)return{};if(-1===e.indexOf("=")&&-1===e.indexOf("&"))return{};e=t._cleanParamStr(e);var r={},a=e.split("&");for(var n in a){var i=a[n].split("="),o=decodeURIComponent(i[0]),s=decodeURIComponent(i[1]);t._access(r,o,s)}return r},t._access=function(e,r,a){var n=a!==void 0,i=-1,o={"true":!0,"false":!1,"null":null};if(("string"==typeof r||"[object String]"==toString.call(r))&&(i=r.search(/[\.\[]/)),-1===i)return t.coerceMode&&(a=a&&!isNaN(a)?+a:"undefined"===a?void 0:void 0!==o[a]?o[a]:a),n?e[r]=a:e[r];var s=r.substr(0,i),u=r.substr(i+1);switch(r.charAt(i)){case"[":return e[s]=e[s]||[],u=u.replace("]",""),-1===u.search(/[\.\[]/)&&(u=parseInt(u,10)),t._access(e[s],u,a);case".":return e[s]=e[s]||{},t._access(e[s],u,a)}return e},t.stringify=function(e,r){switch(typeof e){case"object":var a,n=[];for(var i in e)if(e.hasOwnProperty(i)){var o=e[i];void 0!==i&&0!==i.length&&void 0!==o&&(a=r?r+"."+i:i,e.length!==void 0&&(a=r?r+"["+i+"]":i),"object"==typeof o?n.push(t.stringify(o,a)):n.push(encodeURIComponent(a)+"="+encodeURIComponent(o)))}return n.join("&")}return encodeURIComponent(e)},t.url=function(){var e=t.urlUseHash?t.hashQuerySeperator:t.querySeperator,r=[location.pathname,e],a={};switch(arguments.length){case 1:r.push(t.stringify(arguments[0]));break;case 2:r[0]=t._cleanPath(arguments[0]),a=t.parse(arguments[0]),a=t.merge(a,arguments[1]),r.push(t.stringify(a));break;case 3:r[0]=t._cleanPath(arguments[0]),r[1]=t.querySeperator,r.push(t.stringify(arguments[1])),"string"==typeof arguments[2]?r.push(t.hashSeperator):r.push(t.hashQuerySeperator),r.push(t.stringify(arguments[2]))}var n=r.join("");return n.indexOf(e)==n.length-e.length&&(n=n.substr(0,n.length-e.length)),n},t.urlUseHash=!1,t.querySeperator="?",t.hashSeperator="#",t.hashQuerySeperator="#?",t.coerceMode=!0,t.all=function(){var e=t.parse(t.querystring()+"&"+t.hashstring());return t._all?t._all:t._all=e},t.get=function(e,r){var a=t._access(t.all(),e);return a===void 0?r:a},t.query=function(){return t._query?t._query:t._query=t.parse(t.querystring())},t.hash=function(){return t._hash?t._hash:t._hash=t.parse(t.hashstring())},t.querystring=function(){return t._cleanParamStr(location.search)},t.hashstring=function(){return t._cleanParamStr(location.hash)},t._cleanParamStr=function(e){if(e.indexOf(t.querySeperator)>-1&&(e=e.split(t.querySeperator)[1]),e.indexOf(t.hashSeperator)>-1&&(e=e.split(t.hashSeperator)[1]),-1===e.indexOf("=")&&-1===e.indexOf("&"))return"";for(;0==e.indexOf(t.hashSeperator)||0==e.indexOf(t.querySeperator);)e=e.substr(1);return e},t._cleanPath=function(e){return e.indexOf(t.querySeperator)>-1&&(e=e.substr(0,e.indexOf(t.querySeperator))),e.indexOf(t.hashSeperator)>-1&&(e=e.substr(0,e.indexOf(t.hashSeperator))),e},t.merge=function(){var e={};for(var t in arguments)for(var r in arguments[t])e[r]=arguments[t][r];return e},t},e.Arg=MakeArg()})(window),function(e,t){"use strict";var r=e.History=e.History||{};if(r.Adapter!==void 0)throw Error("History.js Adapter has already been loaded...");r.Adapter={handlers:{},_uid:1,uid:function(e){return e._uid||(e._uid=r.Adapter._uid++)},bind:function(e,t,a){var n=r.Adapter.uid(e);r.Adapter.handlers[n]=r.Adapter.handlers[n]||{},r.Adapter.handlers[n][t]=r.Adapter.handlers[n][t]||[],r.Adapter.handlers[n][t].push(a),e["on"+t]=function(e,t){return function(a){r.Adapter.trigger(e,t,a)}}(e,t)},trigger:function(e,t,a){a=a||{};var n,i,o=r.Adapter.uid(e);for(r.Adapter.handlers[o]=r.Adapter.handlers[o]||{},r.Adapter.handlers[o][t]=r.Adapter.handlers[o][t]||[],n=0,i=r.Adapter.handlers[o][t].length;i>n;++n)r.Adapter.handlers[o][t][n].apply(this,[a])},extractEventData:function(e,r){var a=r&&r[e]||t;return a},onDomLoad:function(t){var r=e.setTimeout(function(){t()},2e3);e.onload=function(){clearTimeout(r),t()}}},r.init!==void 0&&r.init()}(window),function(e,t){"use strict";var r=e.console||t,a=e.document,n=e.navigator,i=!1,o=e.setTimeout,s=e.clearTimeout,u=e.setInterval,l=e.clearInterval,h=e.JSON,c=e.alert,d=e.History=e.History||{},p=e.history;try{i=e.sessionStorage,i.setItem("TEST","1"),i.removeItem("TEST")}catch(f){i=!1}if(h.stringify=h.stringify||h.encode,h.parse=h.parse||h.decode,d.init!==void 0)throw Error("History.js Core has already been loaded...");d.init=function(){return d.Adapter===void 0?!1:(d.initCore!==void 0&&d.initCore(),d.initHtml4!==void 0&&d.initHtml4(),!0)},d.initCore=function(){if(d.initCore.initialized!==void 0)return!1;if(d.initCore.initialized=!0,d.options=d.options||{},d.options.hashChangeInterval=d.options.hashChangeInterval||100,d.options.safariPollInterval=d.options.safariPollInterval||500,d.options.doubleCheckInterval=d.options.doubleCheckInterval||500,d.options.disableSuid=d.options.disableSuid||!1,d.options.storeInterval=d.options.storeInterval||1e3,d.options.busyDelay=d.options.busyDelay||250,d.options.debug=d.options.debug||!1,d.options.initialTitle=d.options.initialTitle||a.title,d.options.html4Mode=d.options.html4Mode||!1,d.options.delayInit=d.options.delayInit||!1,d.intervalList=[],d.clearAllIntervals=function(){var e,t=d.intervalList;if(t!==void 0&&null!==t){for(e=0;t.length>e;e++)l(t[e]);d.intervalList=null}},d.debug=function(){(d.options.debug||!1)&&d.log.apply(d,arguments)},d.log=function(){var e,t,n,i,o,s=r!==void 0&&r.log!==void 0&&r.log.apply!==void 0,u=a.getElementById("log");for(s?(i=Array.prototype.slice.call(arguments),e=i.shift(),r.debug!==void 0?r.debug.apply(r,[e,i]):r.log.apply(r,[e,i])):e="\n"+arguments[0]+"\n",t=1,n=arguments.length;n>t;++t){if(o=arguments[t],"object"==typeof o&&h!==void 0)try{o=h.stringify(o)}catch(l){}e+="\n"+o+"\n"}return u?(u.value+=e+"\n-----\n",u.scrollTop=u.scrollHeight-u.clientHeight):s||c(e),!0},d.getInternetExplorerMajorVersion=function(){var e=d.getInternetExplorerMajorVersion.cached=d.getInternetExplorerMajorVersion.cached!==void 0?d.getInternetExplorerMajorVersion.cached:function(){for(var e=3,t=a.createElement("div"),r=t.getElementsByTagName("i");(t.innerHTML="<!--[if gt IE "+ ++e+"]><i></i><![endif]-->")&&r[0];);return e>4?e:!1}();return e},d.isInternetExplorer=function(){var e=d.isInternetExplorer.cached=d.isInternetExplorer.cached!==void 0?d.isInternetExplorer.cached:Boolean(d.getInternetExplorerMajorVersion());return e},d.emulated=d.options.html4Mode?{pushState:!0,hashChange:!0}:{pushState:!Boolean(e.history&&e.history.pushState&&e.history.replaceState&&!/ Mobile\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i.test(n.userAgent)&&!/AppleWebKit\/5([0-2]|3[0-2])/i.test(n.userAgent)),hashChange:Boolean(!("onhashchange"in e||"onhashchange"in a)||d.isInternetExplorer()&&8>d.getInternetExplorerMajorVersion())},d.enabled=!d.emulated.pushState,d.bugs={setHash:Boolean(!d.emulated.pushState&&"Apple Computer, Inc."===n.vendor&&/AppleWebKit\/5([0-2]|3[0-3])/.test(n.userAgent)),safariPoll:Boolean(!d.emulated.pushState&&"Apple Computer, Inc."===n.vendor&&/AppleWebKit\/5([0-2]|3[0-3])/.test(n.userAgent)),ieDoubleCheck:Boolean(d.isInternetExplorer()&&8>d.getInternetExplorerMajorVersion()),hashEscape:Boolean(d.isInternetExplorer()&&7>d.getInternetExplorerMajorVersion())},d.isEmptyObject=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},d.cloneObject=function(e){var t,r;return e?(t=h.stringify(e),r=h.parse(t)):r={},r},d.getRootUrl=function(){var e=a.location.protocol+"//"+(a.location.hostname||a.location.host);return a.location.port&&(e+=":"+a.location.port),e+="/"},d.getBaseHref=function(){var e=a.getElementsByTagName("base"),t=null,r="";return 1===e.length&&(t=e[0],r=t.href.replace(/[^\/]+$/,"")),r=r.replace(/\/+$/,""),r&&(r+="/"),r},d.getBaseUrl=function(){var e=d.getBaseHref()||d.getBasePageUrl()||d.getRootUrl();return e},d.getPageUrl=function(){var e,t=d.getState(!1,!1),r=(t||{}).url||d.getLocationHref();return e=r.replace(/\/+$/,"").replace(/[^\/]+$/,function(e){return/\./.test(e)?e:e+"/"})},d.getBasePageUrl=function(){var e=d.getLocationHref().replace(/[#\?].*/,"").replace(/[^\/]+$/,function(e){return/[^\/]$/.test(e)?"":e}).replace(/\/+$/,"")+"/";return e},d.getFullUrl=function(e,t){var r=e,a=e.substring(0,1);return t=t===void 0?!0:t,/[a-z]+\:\/\//.test(e)||(r="/"===a?d.getRootUrl()+e.replace(/^\/+/,""):"#"===a?d.getPageUrl().replace(/#.*/,"")+e:"?"===a?d.getPageUrl().replace(/[\?#].*/,"")+e:t?d.getBaseUrl()+e.replace(/^(\.\/)+/,""):d.getBasePageUrl()+e.replace(/^(\.\/)+/,"")),r.replace(/\#$/,"")},d.getShortUrl=function(e){var t=e,r=d.getBaseUrl(),a=d.getRootUrl();return d.emulated.pushState&&(t=t.replace(r,"")),t=t.replace(a,"/"),d.isTraditionalAnchor(t)&&(t="./"+t),t=t.replace(/^(\.\/)+/g,"./").replace(/\#$/,"")},d.getLocationHref=function(e){return e=e||a,e.URL===e.location.href?e.location.href:e.location.href===decodeURIComponent(e.URL)?e.URL:e.location.hash&&decodeURIComponent(e.location.href.replace(/^[^#]+/,""))===e.location.hash?e.location.href:-1==e.URL.indexOf("#")&&-1!=e.location.href.indexOf("#")?e.location.href:e.URL||e.location.href},d.store={},d.idToState=d.idToState||{},d.stateToId=d.stateToId||{},d.urlToId=d.urlToId||{},d.storedStates=d.storedStates||[],d.savedStates=d.savedStates||[],d.normalizeStore=function(){d.store.idToState=d.store.idToState||{},d.store.urlToId=d.store.urlToId||{},d.store.stateToId=d.store.stateToId||{}},d.getState=function(e,t){e===void 0&&(e=!0),t===void 0&&(t=!0);var r=d.getLastSavedState();return!r&&t&&(r=d.createStateObject()),e&&(r=d.cloneObject(r),r.url=r.cleanUrl||r.url),r},d.getIdByState=function(e){var t,r=d.extractId(e.url);if(!r)if(t=d.getStateString(e),d.stateToId[t]!==void 0)r=d.stateToId[t];else if(d.store.stateToId[t]!==void 0)r=d.store.stateToId[t];else{for(;r=(new Date).getTime()+(Math.random()+"").replace(/\D/g,""),d.idToState[r]!==void 0||d.store.idToState[r]!==void 0;);d.stateToId[t]=r,d.idToState[r]=e}return r},d.normalizeState=function(e){var t,r;return e&&"object"==typeof e||(e={}),e.normalized!==void 0?e:(e.data&&"object"==typeof e.data||(e.data={}),t={},t.normalized=!0,t.title=e.title||"",t.url=d.getFullUrl(e.url?e.url:d.getLocationHref()),t.hash=d.getShortUrl(t.url),t.data=d.cloneObject(e.data),t.id=d.getIdByState(t),t.cleanUrl=t.url.replace(/\??\&_suid.*/,""),t.url=t.cleanUrl,r=!d.isEmptyObject(t.data),(t.title||r)&&d.options.disableSuid!==!0&&(t.hash=d.getShortUrl(t.url).replace(/\??\&_suid.*/,""),/\?/.test(t.hash)||(t.hash+="?"),t.hash+="&_suid="+t.id),t.hashedUrl=d.getFullUrl(t.hash),(d.emulated.pushState||d.bugs.safariPoll)&&d.hasUrlDuplicate(t)&&(t.url=t.hashedUrl),t)},d.createStateObject=function(e,t,r){var a={data:e,title:t,url:r};return a=d.normalizeState(a)},d.getStateById=function(e){e+="";var r=d.idToState[e]||d.store.idToState[e]||t;return r},d.getStateString=function(e){var t,r,a;return t=d.normalizeState(e),r={data:t.data,title:e.title,url:e.url},a=h.stringify(r)},d.getStateId=function(e){var t,r;return t=d.normalizeState(e),r=t.id},d.getHashByState=function(e){var t,r;return t=d.normalizeState(e),r=t.hash},d.extractId=function(e){var t,r,a,n;return n=-1!=e.indexOf("#")?e.split("#")[0]:e,r=/(.*)\&_suid=([0-9]+)$/.exec(n),a=r?r[1]||e:e,t=r?(r[2]||"")+"":"",t||!1},d.isTraditionalAnchor=function(e){var t=!/[\/\?\.]/.test(e);return t},d.extractState=function(e,t){var r,a,n=null;return t=t||!1,r=d.extractId(e),r&&(n=d.getStateById(r)),n||(a=d.getFullUrl(e),r=d.getIdByUrl(a)||!1,r&&(n=d.getStateById(r)),!n&&t&&!d.isTraditionalAnchor(e)&&(n=d.createStateObject(null,null,a))),n},d.getIdByUrl=function(e){var r=d.urlToId[e]||d.store.urlToId[e]||t;return r},d.getLastSavedState=function(){return d.savedStates[d.savedStates.length-1]||t},d.getLastStoredState=function(){return d.storedStates[d.storedStates.length-1]||t},d.hasUrlDuplicate=function(e){var t,r=!1;return t=d.extractState(e.url),r=t&&t.id!==e.id},d.storeState=function(e){return d.urlToId[e.url]=e.id,d.storedStates.push(d.cloneObject(e)),e},d.isLastSavedState=function(e){var t,r,a,n=!1;return d.savedStates.length&&(t=e.id,r=d.getLastSavedState(),a=r.id,n=t===a),n},d.saveState=function(e){return d.isLastSavedState(e)?!1:(d.savedStates.push(d.cloneObject(e)),!0)},d.getStateByIndex=function(e){var t=null;return t=e===void 0?d.savedStates[d.savedStates.length-1]:0>e?d.savedStates[d.savedStates.length+e]:d.savedStates[e]},d.getCurrentIndex=function(){var e=null;return e=1>d.savedStates.length?0:d.savedStates.length-1},d.getHash=function(e){var t,r=d.getLocationHref(e);return t=d.getHashByUrl(r)},d.unescapeHash=function(e){var t=d.normalizeHash(e);return t=decodeURIComponent(t)},d.normalizeHash=function(e){var t=e.replace(/[^#]*#/,"").replace(/#.*/,"");return t},d.setHash=function(e,t){var r,n;return t!==!1&&d.busy()?(d.pushQueue({scope:d,callback:d.setHash,args:arguments,queue:t}),!1):(d.busy(!0),r=d.extractState(e,!0),r&&!d.emulated.pushState?d.pushState(r.data,r.title,r.url,!1):d.getHash()!==e&&(d.bugs.setHash?(n=d.getPageUrl(),d.pushState(null,null,n+"#"+e,!1)):a.location.hash=e),d)},d.escapeHash=function(t){var r=d.normalizeHash(t);return r=e.encodeURIComponent(r),d.bugs.hashEscape||(r=r.replace(/\%21/g,"!").replace(/\%26/g,"&").replace(/\%3D/g,"=").replace(/\%3F/g,"?")),r},d.getHashByUrl=function(e){var t=(e+"").replace(/([^#]*)#?([^#]*)#?(.*)/,"$2");return t=d.unescapeHash(t)},d.setTitle=function(e){var t,r=e.title;r||(t=d.getStateByIndex(0),t&&t.url===e.url&&(r=t.title||d.options.initialTitle));try{a.getElementsByTagName("title")[0].innerHTML=r.replace("<","&lt;").replace(">","&gt;").replace(" & "," &amp; ")}catch(n){}return a.title=r,d},d.queues=[],d.busy=function(e){if(e!==void 0?d.busy.flag=e:d.busy.flag===void 0&&(d.busy.flag=!1),!d.busy.flag){s(d.busy.timeout);var t=function(){var e,r,a;if(!d.busy.flag)for(e=d.queues.length-1;e>=0;--e)r=d.queues[e],0!==r.length&&(a=r.shift(),d.fireQueueItem(a),d.busy.timeout=o(t,d.options.busyDelay))};d.busy.timeout=o(t,d.options.busyDelay)}return d.busy.flag},d.busy.flag=!1,d.fireQueueItem=function(e){return e.callback.apply(e.scope||d,e.args||[])},d.pushQueue=function(e){return d.queues[e.queue||0]=d.queues[e.queue||0]||[],d.queues[e.queue||0].push(e),d},d.queue=function(e,t){return"function"==typeof e&&(e={callback:e}),t!==void 0&&(e.queue=t),d.busy()?d.pushQueue(e):d.fireQueueItem(e),d},d.clearQueue=function(){return d.busy.flag=!1,d.queues=[],d},d.stateChanged=!1,d.doubleChecker=!1,d.doubleCheckComplete=function(){return d.stateChanged=!0,d.doubleCheckClear(),d},d.doubleCheckClear=function(){return d.doubleChecker&&(s(d.doubleChecker),d.doubleChecker=!1),d},d.doubleCheck=function(e){return d.stateChanged=!1,d.doubleCheckClear(),d.bugs.ieDoubleCheck&&(d.doubleChecker=o(function(){return d.doubleCheckClear(),d.stateChanged||e(),!0},d.options.doubleCheckInterval)),d},d.safariStatePoll=function(){var t,r=d.extractState(d.getLocationHref());return d.isLastSavedState(r)?void 0:(t=r,t||(t=d.createStateObject()),d.Adapter.trigger(e,"popstate"),d)},d.back=function(e){return e!==!1&&d.busy()?(d.pushQueue({scope:d,callback:d.back,args:arguments,queue:e}),!1):(d.busy(!0),d.doubleCheck(function(){d.back(!1)}),p.go(-1),!0)},d.forward=function(e){return e!==!1&&d.busy()?(d.pushQueue({scope:d,callback:d.forward,args:arguments,queue:e}),!1):(d.busy(!0),d.doubleCheck(function(){d.forward(!1)}),p.go(1),!0)},d.go=function(e,t){var r;if(e>0)for(r=1;e>=r;++r)d.forward(t);else{if(!(0>e))throw Error("History.go: History.go requires a positive or negative integer passed.");for(r=-1;r>=e;--r)d.back(t)}return d},d.emulated.pushState){var f=function(){};d.pushState=d.pushState||f,d.replaceState=d.replaceState||f}else d.onPopState=function(t,r){var a,n,i=!1,o=!1;return d.doubleCheckComplete(),a=d.getHash(),a?(n=d.extractState(a||d.getLocationHref(),!0),n?d.replaceState(n.data,n.title,n.url,!1):(d.Adapter.trigger(e,"anchorchange"),d.busy(!1)),d.expectedStateId=!1,!1):(i=d.Adapter.extractEventData("state",t,r)||!1,o=i?d.getStateById(i):d.expectedStateId?d.getStateById(d.expectedStateId):d.extractState(d.getLocationHref()),o||(o=d.createStateObject(null,null,d.getLocationHref())),d.expectedStateId=!1,d.isLastSavedState(o)?(d.busy(!1),!1):(d.storeState(o),d.saveState(o),d.setTitle(o),d.Adapter.trigger(e,"statechange"),d.busy(!1),!0))},d.Adapter.bind(e,"popstate",d.onPopState),d.pushState=function(t,r,a,n){if(d.getHashByUrl(a)&&d.emulated.pushState)throw Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(n!==!1&&d.busy())return d.pushQueue({scope:d,callback:d.pushState,args:arguments,queue:n}),!1;d.busy(!0);var i=d.createStateObject(t,r,a);return d.isLastSavedState(i)?d.busy(!1):(d.storeState(i),d.expectedStateId=i.id,p.pushState(i.id,i.title,i.url),d.Adapter.trigger(e,"popstate")),!0},d.replaceState=function(t,r,a,n){if(d.getHashByUrl(a)&&d.emulated.pushState)throw Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(n!==!1&&d.busy())return d.pushQueue({scope:d,callback:d.replaceState,args:arguments,queue:n}),!1;d.busy(!0);var i=d.createStateObject(t,r,a);return d.isLastSavedState(i)?d.busy(!1):(d.storeState(i),d.expectedStateId=i.id,p.replaceState(i.id,i.title,i.url),d.Adapter.trigger(e,"popstate")),!0};if(i){try{d.store=h.parse(i.getItem("History.store"))||{}}catch(g){d.store={}}d.normalizeStore()}else d.store={},d.normalizeStore();d.Adapter.bind(e,"unload",d.clearAllIntervals),d.saveState(d.storeState(d.extractState(d.getLocationHref(),!0))),i&&(d.onUnload=function(){var e,t,r;try{e=h.parse(i.getItem("History.store"))||{}}catch(a){e={}}e.idToState=e.idToState||{},e.urlToId=e.urlToId||{},e.stateToId=e.stateToId||{};for(t in d.idToState)d.idToState.hasOwnProperty(t)&&(e.idToState[t]=d.idToState[t]);for(t in d.urlToId)d.urlToId.hasOwnProperty(t)&&(e.urlToId[t]=d.urlToId[t]);for(t in d.stateToId)d.stateToId.hasOwnProperty(t)&&(e.stateToId[t]=d.stateToId[t]);d.store=e,d.normalizeStore(),r=h.stringify(e);try{i.setItem("History.store",r)}catch(n){if(n.code!==DOMException.QUOTA_EXCEEDED_ERR)throw n;i.length&&(i.removeItem("History.store"),i.setItem("History.store",r))}},d.intervalList.push(u(d.onUnload,d.options.storeInterval)),d.Adapter.bind(e,"beforeunload",d.onUnload),d.Adapter.bind(e,"unload",d.onUnload)),d.emulated.pushState||(d.bugs.safariPoll&&d.intervalList.push(u(d.safariStatePoll,d.options.safariPollInterval)),("Apple Computer, Inc."===n.vendor||"Mozilla"===(n.appCodeName||""))&&(d.Adapter.bind(e,"hashchange",function(){d.Adapter.trigger(e,"popstate")}),d.getHash()&&d.Adapter.onDomLoad(function(){d.Adapter.trigger(e,"hashchange")})))},(!d.options||!d.options.delayInit)&&d.init()}(window),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){"use strict";if(void 0===this||null===this)throw new TypeError;var t=Object(this),r=t.length>>>0;if(0===r)return-1;var a=0;if(arguments.length>0&&(a=Number(arguments[1]),a!==a?a=0:0!==a&&a!==1/0&&a!==-(1/0)&&(a=(a>0||-1)*Math.floor(Math.abs(a)))),a>=r)return-1;for(var n=a>=0?a:Math.max(r-Math.abs(a),0);r>n;n++)if(n in t&&t[n]===e)return n;return-1}),RegExp.escape=function(e){if(!arguments.callee.sRE){var t=["/",".","*","+","?","|","(",")","[","]","{","}","\\"];arguments.callee.sRE=RegExp("(\\"+t.join("|\\")+")","g")}return e.replace(arguments.callee.sRE,"\\$1")},Sherpa={Router:function(e){this.routes={},this.root=new Sherpa.Node,this.requestKeys=e&&e.requestKeys||["method"]},Path:function(e,t){this.route=e;var r=this.pathSplit(t);this.compiledUri=[];for(var a=0;a!=r.length;a++)":"==r[a].substring(0,1)?this.compiledUri.push("params['"+r[a].substring(1)+"']"):this.compiledUri.push("'"+r[a]+"'");this.compiledUri=this.compiledUri.join("+"),this.groups=[];for(var n=0;r.length>n;n++){var i=r[n];"/"==i?this.groups.push([]):""!=i&&this.groups[this.groups.length-1].push(i)}},Route:function(e,t){this.router=e,this.requestConditions={},this.matchingConditions={},this.variableNames=[];for(var r=[""],a=t.split(""),n=0,i=1,o=0;a.length>o;o++){var s=a[o];if("("==s){for(var u=n;u!=i;u++)r.push(r[u]);n=i,i=r.length}else if(")"==s)n-=i-n;else for(var l=n;l!=i;l++)r[l]+=s}this.partial=!1,this.paths=[];for(var h=0;h!=r.length;h++)this.paths.push(new Sherpa.Path(this,r[h]))},Node:function(){this.reset()},Response:function(e,t){this.path=e,this.route=e.route,this.paramsArray=t,this.destination=this.route.destination,this.params={};for(var r=0;r!=this.path.variableNames.length;r++)this.params[this.path.variableNames[r]]=this.paramsArray[r]}},Sherpa.Node.prototype={reset:function(){this.linear=[],this.lookup={},this.catchall=null},dup:function(){for(var e=new Sherpa.Node,t=0;t!=this.linear.length;t++)e.linear.push(this.linear[t]);for(var r in this.lookup)e.lookup[r]=this.lookup[r];return e.catchall=this.catchall,e},addLinear:function(e,t){var r=new Sherpa.Node;return this.linear.push([e,t,r]),r},addCatchall:function(){return this.catchall||(this.catchall=new Sherpa.Node),this.catchall},addLookup:function(e){return this.lookup[e]||(this.lookup[e]=new Sherpa.Node),this.lookup[e]},addRequestNode:function(){return this.requestNode||(this.requestNode=new Sherpa.Node,this.requestNode.requestMethod=null),this.requestNode},find:function(e,t,r){if(this.requestNode||this.destination&&this.destination.route.partial){var a=this;if(a.requestNode&&(a=a.requestNode.findRequest(t)),a&&a.destination&&a.destination.route.partial)return new Sherpa.Response(a.destination,r)}if(0==e.length){var a=this;return this.requestNode&&(a=this.requestNode.findRequest(t)),a&&a.destination?new Sherpa.Response(a.destination,r):void 0}if(0!=this.linear.length)for(var n=e.join("/"),i=0;i!=this.linear.length;i++){var o=this.linear[i],s=o[0].exec(n);if(s){var u=[];if(void 0===s[1])u.push(s[0]);else for(var l=1;o[1]+1>=l;l++)u.push(s[l]);var h=r.concat(u);matchedIndex=s.shift().length;var c=n.substring(matchedIndex).split("/");1==c.length&&""==c[0]&&c.shift();var d=o[2].find(c,t,h);if(d)return d}}if(this.lookup[e[0]]){var d=this.lookup[e[0]].find(e.slice(1,e.length),t,r);if(d)return d}if(this.catchall){var p=e.shift();return r.push(p),this.catchall.find(e,t,r)}return void 0},findRequest:function(e){if(!this.requestMethod)return this.destination?this:void 0;if(0!=this.linear.length&&e[this.requestMethod])for(var t=0;t!=this.linear.length;t++){var r=this.linear[t],a=r[0].exec(e[this.requestMethod]);if(a){matchedIndex=a.shift().length;var n=r[2].findRequest(e);if(n)return n}}if(e[this.requestMethod]&&this.lookup[e[this.requestMethod]]){var n=this.lookup[e[this.requestMethod]].findRequest(e);if(n)return n}return this.catchall?this.catchall.findRequest(e):void 0},transplantValue:function(){if(this.destination&&this.requestNode){for(var e=this.requestNode;e.requestMethod;)e=e.addCatchall();e.destination=this.destination,this.destination=void 0}},compileRequestConditions:function(e,t){var r=[this],a=e.requestKeys;for(var n in a){var i=a[n];if(t[i]){1==r.length&&r[0]===this&&(r=[this.addRequestNode()]);for(var o=0;o!=r.length;o++){var s=r[o];s.requestMethod||(s.requestMethod=i);var u=a.indexOf(i),l=a.indexOf(s.requestMethod);if(u==l)r[o]=t[i].compile?r[o].addLinear(t[i],0):r[o].addLookup(t[i]);else if(l>u)r[o]=r[o].addCatchall();else{var h=s.dup();s.reset(),s.requestMethod=i,s.catchall=h,o--}}}else for(var o=0;o!=r.length;o++){var c=r[o];!c.requestMethod&&c.requestNode&&(c=c.requestNode),c.requestMethod&&(r[o]=c.addCatchall(),r[o].requestMethod=null)}}return this.transplantValue(),r}},Sherpa.Router.prototype={generate:function(e,t){return this.routes[e].generate(t)},add:function(e,t){var r=new Sherpa.Route(this,e);return t&&r.withOptions(t),r},recognize:function(e,t){return"/"==e.substring(0,1)&&(e=e.substring(1)),this.root.find(""==e?[]:e.split(/\//),t,[])}},Sherpa.Route.prototype={withOptions:function(e){return e.conditions&&this.condition(e.conditions),e.matchesWith&&this.matchesWith(e.matchesWith),e.matchPartially&&this.matchPartially(e.matchPartially),e.name&&this.matchPartially(e.name),this},name:function(e){return this.router.routes[e]=this,this},matchPartially:function(e){return this.partial=void 0===e||e===!0,this},matchesWith:function(e){for(var t in e)this.matchingConditions[t]=e[t];return this},compile:function(){for(var e=0;e!=this.paths.length;e++){this.paths[e].compile();for(var t=0;t!=this.paths[e].variableNames.length;t++)-1==this.variableNames.indexOf(this.paths[e].variableNames[t])&&this.variableNames.push(this.paths[e].variableNames[t])}},to:function(e){return this.compile(),this.destination=e,this},condition:function(e){for(var t in e)this.requestConditions[t]=e[t];return this},generate:function(e){var t=void 0;if(void 0==e||1==this.paths.length)t=this.paths[0].generate(e);else for(var r=this.paths.length-1;r>=0&&!(t=this.paths[r].generate(e));r--);if(t){t=encodeURI(t);var a="";for(var n in e)a+=(""==a?"?":"&")+encodeURIComponent(n)+"="+encodeURIComponent(e[n]);return t+a}return void 0}},Sherpa.Path.prototype={pathSplit:function(e){var t=[],r=e.split("/");""==r[0]&&r.shift();for(var a=0;a!=r.length;a++){t.push("/"),t.push(""),partChars=r[a].split("");for(var n=!1,i=0;i!=partChars.length;i++)if(n){var o=partChars[i].charCodeAt(0);o>=48&&57>=o||o>=65&&90>=o||o>=97&&122>=o||95==o?t[t.length-1]+=partChars[i]:(n=!1,t.push(partChars[i]))}else":"==partChars[i]?(n=!0,""==t[t.length-1]?t[t.length-1]+=":":t.push(":")):t[t.length-1]+=partChars[i]}return t},generate:function(params){for(var varIdx=0;varIdx!=this.variableNames.length;varIdx++)if(!params[this.variableNames[varIdx]])return void 0;for(var varIdx=0;varIdx!=this.variableNames.length;varIdx++)if(this.route.matchingConditions[this.variableNames[varIdx]]&&this.route.matchingConditions[this.variableNames[varIdx]].exec(""+params[this.variableNames[varIdx]])!=""+params[this.variableNames[varIdx]])return void 0;for(var path=eval(this.compiledUri),varIdx=0;varIdx!=this.variableNames.length;varIdx++)delete params[this.variableNames[varIdx]];return path},compile:function(){this.variableNames=[];for(var e=this.route.router.root,t=0;t!=this.groups.length;t++){var r=this.groups[t];if(r.length>1){for(var a="^",n=0;n!=r.length;n++){var i=r[n],o=0;if(":"==i.substring(0,1)){var s=i.substring(1);this.variableNames.push(s),a+=this.route.matchingConditions[s]?""+this.route.matchingConditions[s]:"(.*?)",o+=1}else a+=RegExp.escape(i)}e=e.addLinear(RegExp(a),o)}else if(1==r.length){var i=r[0];if(":"==i.substring(0,1)){var s=i.substring(1);this.variableNames.push(s),e=this.route.matchingConditions[s]?e.addLinear(RegExp(this.route.matchingConditions[s]),1):e.addCatchall()}else e=e.addLookup(i)}}for(var u=e.compileRequestConditions(this.route.router,this.route.requestConditions),l=0;l!=u.length;l++)u[l].destination=this}},function(e){"use strict";function t(e){var t=[];return e?(o.each(e,function(e,r){var a,n=r.split(" "),i=n[0].replace(/,/g," "),s=n.slice(1).join(" "),u=e;"statechange"===i?(a=window,e=function(){var e=History.getState().data.query;u(e)},o.addEvent(a,i,e)):(a=p,o.addEvent(a,i,s,e)),t.push({name:i,selector:s,callback:e,elem:a})}),t):t}function r(e){0!==e.length&&o.each(e,function(e){o.removeEvent(e.elem,e.name,e.selector,e.callback)})}var a;a=function(){this.routes={},this.filters={}},"object"==typeof module&&"object"==typeof module.exports?module.exports=a:e.Doppelganger=a;var n,i,o,s,u=Array.prototype,l=u.slice,h=u.isArray,c=u.forEach,d=u.indexOf,p=e.document||{},f=e.Sherpa||{Router:function(){}},g=e.Arg||{all:function(){}},v={};a.util=o={getterSetterCreator:function(e){return function(t,r){var a=this[e];if("string"!=typeof t)o.isArray(a)?o.isArray(t)?a.concat(t):a.push(t):o.extend(a,t);else{if(!r)return a[t];a[t]=r}}},capitolize:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},extend:function(e){var t,r,a,n=l.call(arguments,1);for(r=0;n.length>r;r++)if(t=n[r])for(a in t)e[a]=t[a];return e},each:function(e,t,r){if(null!=e)if(c&&e.forEach===c)e.forEach(t,r);else if(e.length===+e.length){for(var a=0,n=e.length;n>a;a++)if(t.call(r,e[a],a,e)===!1)return}else for(var i in e)if(e.hasOwnProperty(i)&&t(e[i],i,e)===!1)break},isArray:h||function(e){return e&&"object"==typeof e&&"number"==typeof e.length&&"[object Array]"==""+e||!1},indexOf:function(e,t){if(null==e)return-1;var r=0,a=e.length;if(d&&e.indexOf===d)return e.indexOf(t);for(;a>r;r++)if(e[r]===t)return r;return-1},map:function(e,t){var r=-1,a=e?e.length:0,n=Array("number"==typeof a?a:0);if(o.isArray(e))for(;a>++r;)n[r]=t(e[r],r,e);else o.each(e,function(e,a,i){n[++r]=t(e,a,i)});return n},$:function(e){return p.querySelectorAll(e)},matchesSelector:function(e,t){var r,a;if(e.matches)return e.matches(t);e.parentNode||(r=p.createDocumentFragment(),r.appendChild(e)),a=e.parentNode.querySelectorAll(t);for(var n=0,i=a.length;i>n;n++)if(a[n]===e)return!0;return!1},addEvent:function(e,t,r,a){var n=a;if(a=a?function(e){var t=e.target||e.srcElement;o.matchesSelector(t,r)&&n.apply(this,arguments)}:r,e.addEventListener)e.addEventListener(t,a,!1);else{if(!e.attachEvent)throw Error("addEvent() was called in a context without event listener support");e.attachEvent("on"+t,a)}v[t]||(v[t]=[]),v[t].push({fn:n,boundFn:a,selector:"string"==typeof r?r:""})},removeEvent:function(e,t,r,a){for(var n,i,o=v[t],s=o?o.length:0,u=0;s>u;u++)if(n=o[u],a===n.fn&&r===n.selector){i=n.boundFn,o.splice(u,1);break}if(i)if(e.removeEventListener)e.removeEventListener(t,i);else{if(!e.detachEvent)throw Error("removeEvent() was called in a context without event listener support");e.detachEvent(t,i)}}},s=o.$;var m={routes:{index:""},filters:["EventFilter","RouterFilter"]},S={routes:"routeManager",filters:"filterManager"};a.create=function(e){var t,r,n=new a;n.options=o.extend({},m,e.options),n.filterManager=new a.FilterManager(n),n.routeManager=new a.RouteManager(n,e.rootUrl);for(var i in S)S.hasOwnProperty(i)&&(t=S[i],r=e[i]||n.options[i],n[t].add(r));return n},a.prototype={init:function(){var e=this;History.Adapter.bind(window,"statechange",function(){var t=History.getState();t.data&&t.data.controllerStateChange||e.trigger(t.data.destination,t.data.params)}),this.startPage=this.routeManager.recognize(window.location.pathname),this.navigate()},navigate:function(){this.navigate=function(t,r){history.pushState?History.pushState({destination:t,params:r},p.title,this.routeManager.generate(t,r)):e.location=e.helpers.routing.generate(t,r)},this.startPage?(this.startPage=o.extend({},this.startPage),this.startPage.params=o.extend(this.startPage.params,g.all()),this.filterManager.process(this.startPage)):this.navigate(this.options.defaultRoute[0],this.options.defaultRoute[1])},trigger:function(e,t){this.filterManager.process({destination:e,params:t})},updateContent:function(e){var t=s(this.PAGE_CONTENT_SELECTOR);return t.append(e)}},a.RouteHandlers={},a.setRouteHandler=o.getterSetterCreator("RouteHandlers"),a.getRouteHandler=o.getterSetterCreator("RouteHandlers"),a.FilterHandlers={},a.setFilterHandler=o.getterSetterCreator("FilterHandlers"),a.getFilterHandler=o.getterSetterCreator("FilterHandlers"),a.RouteManager=i=function(e,t){this.app=e,this.router=new f.Router,this.baseUrl=t,this.routes={}},a.RouteManager.prototype={add:function(e){for(var t,r,a,n=e.length,i=0;n>i;i++)t=e[i],r=t.name,a=t.url,this.router.add(this.baseUrl+a,t).to(r).name(r);o.extend(this.router,t)},get:o.getterSetterCreator("routes"),recognize:function(e){return this.router.recognize(e)},generate:function(e,t){return this.router.generate(e,o.extend({},t))},trigger:function(e,t){return a.getRouteHandler(e).call(this.app,t)}};var y=0;a.FilterManager=n=function(e){this.filters=[],this.app=e},a.FilterManager.prototype={add:o.getterSetterCreator("filters"),remove:function(e){var t=o.indexOf(e,this.filters);t!==!1&&(y>t&&(y-=1),this.filters.splice(t,1))},process:function(e){for(y=0;this.filters.length>y;y++){var t=this.filters[y];e=a.getFilterHandler(t).call(this.app,e)}}},a.setFilterHandler("RouterFilter",function(e){return!e.destination||!e.params,e.destination&&(e=o.extend(e,this.routeManager.trigger(e.destination,e))),e});var b=[];a.setFilterHandler("EventFilter",function(e){return e.partial||r(b),b=b.concat(t(e.events)),e})}(this);