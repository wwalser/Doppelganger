(function(t){"use strict";function e(t){var e=[];return t?(o.each(t,function(t,r){var n=t.split(" "),a=n[0].replace(/,/g," "),i=n.slice(1).join(" "),s=r;"statechange"===a?(r=function(){var t=History.getState().data.query;s(t)},o.addEvent(window,a,r)):o.addEvent(g,a,i,r),e.push({name:a,selector:i,callback:r})}),e):e}function r(t){0!==t.length&&o.each(t,function(t,e){o.removeEvent(e.name,e.selector,e.callback)})}var n;n=function(){this.routes={},this.filters={}},"object"==typeof module&&"object"==typeof module.exports?module.exports=n:t.Doppelganger=n;var a,i,o,s,u=Array.prototype,l=u.slice,c=u.isArray,f=u.forEach,h=u.indexOf,g=t.document||{},d=t.Sherpa||{Router:function(){}},p=t.Arg||{all:function(){}};n.util=o={getterSetterCreator:function(t){return function(e,r){var n=this[t];if("string"!=typeof e)o.isArray(n)?o.isArray(e)?n.concat(e):n.push(e):o.extend(n,e);else{if(!r)return n[e];n[e]=r}}},capitolize:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},extend:function(t){var e,r,n,a=l.call(arguments,1);for(r=0;a.length>r;r++)if(e=a[r])for(n in e)t[n]=e[n];return t},each:function(t,e,r){if(null!=t)if(f&&t.forEach===f)t.forEach(e,r);else if(t.length===+t.length){for(var n=0,a=t.length;a>n;n++)if(e.call(r,t[n],n,t)===!1)return}else for(var i in t)if(t.hasOwnProperty(i)&&e(t[i],i,t)===!1)break},isArray:c||function(t){return t&&"object"==typeof t&&"number"==typeof t.length&&"[object Array]"==""+t||!1},indexOf:function(t,e){if(null==t)return-1;var r=0,n=t.length;if(h&&t.indexOf===h)return t.indexOf(e);for(;n>r;r++)if(t[r]===e)return r;return-1},map:function(t,e){var r=-1,n=t?t.length:0,a=Array("number"==typeof n?n:0);if(o.isArray(t))for(;n>++r;)a[r]=e(t[r],r,t);else o.each(t,function(t,n,i){a[++r]=e(t,n,i)});return a},$:function(t){return g.querySelectorAll(t)},matchesSelector:function(t,e){var r,n;if(t.matchesSelector)return t.matchesSelector(e);if(!t.parentNode){r=g.createDocumentFragment(),r.appendChild(t),n=t.parentNode.querySelectorAll(e);for(var a=0,i=n.length;i>a;a++)if(n[a]===t)return!0;return!1}},addEvent:function(t,e,r,n){var a=n;if("function"==typeof r&&(n=function(t){var e=t.target||t.srcElement;o.matchesSelector(e,r)&&a.apply(this,arguments)}),t.addEventListener)t.addEventListener(e,n,!1);else{if(!t.attachEvent)throw Error("addEvent() was called in a context without event listener support");t.attachEvent("on"+e,n)}},removeEvent:function(t,e,r){return[t,e,r]}},s=o.$;var v={routes:{index:""},filters:["EventFilter","RouterFilter"]},m={routes:"routeManager",filters:"filterManager"};n.create=function(t){var e,r,a=new n;a.options=o.extend({},v,t.options),a.filterManager=new n.FilterManager(a),a.routeManager=new n.RouteManager(a,t.rootUrl);for(var i in m)m.hasOwnProperty(i)&&(e=m[i],r=t[i]||a.options[i],a[e].add(r));return a},n.prototype={init:function(){var t=this;History.Adapter.bind(window,"statechange",function(){var e=History.getState();e.data&&e.data.controllerStateChange||t.trigger(e.data.destination,e.data.params)}),this.startPage=this.routeManager.recognize(window.location.pathname),this.navigate()},navigate:function(){this.navigate=function(e,r){history.pushState?History.pushState({destination:e,params:r},g.title,this.routeManager.generate(e,r)):t.location=t.helpers.routing.generate(e,r)},this.startPage?(this.startPage=o.extend({},this.startPage),this.startPage.params=o.extend(this.startPage.params,p.all()),this.filterManager.process(this.startPage)):this.navigate(this.options.defaultRoute[0],this.options.defaultRoute[1])},trigger:function(t,e){this.filterManager.process({destination:t,params:e})},updateContent:function(t){var e=s(this.PAGE_CONTENT_SELECTOR);return e.append(t)}},n.RouteHandlers={},n.setRouteHandler=o.getterSetterCreator("RouteHandlers"),n.getRouteHandler=o.getterSetterCreator("RouteHandlers"),n.FilterHandlers={},n.setFilterHandler=o.getterSetterCreator("FilterHandlers"),n.getFilterHandler=o.getterSetterCreator("FilterHandlers"),n.RouteManager=i=function(t,e){this.app=t,this.router=new d.Router,this.baseUrl=e,this.routes={}},n.RouteManager.prototype={add:function(t){for(var e,r,n,a=t.length,i=0;a>i;i++)e=t[i],r=e.name,n=e.url,this.router.add(this.baseUrl+n,e).to(r).name(r);o.extend(this.router,e)},get:o.getterSetterCreator("routes"),recognize:function(t){return this.router.recognize(t)},generate:function(t,e){return this.router.generate(t,o.extend({},e))},trigger:function(t,e){return n.getRouteHandler(t).call(this.app,e)}};var y=0;n.FilterManager=a=function(t){this.filters=[],this.app=t},n.FilterManager.prototype={add:o.getterSetterCreator("filters"),remove:function(t){var e=o.indexOf(t,this.filters);e!==!1&&(y>e&&(y-=1),this.filters.splice(e,1))},process:function(t){for(y=0;this.filters.length>y;y++){var e=this.filters[y];t=n.getFilterHandler(e).call(this.app,t)}}},n.setFilterHandler("RouterFilter",function(t){return!t.destination||!t.params,t.destination&&(t=o.extend(t,this.routeManager.trigger(t.destination,t))),t});var E=[];n.setFilterHandler("EventFilter",function(t){return t.partial||r(E),E=E.concat(e(t.events)),t})})(this);