(function(t){"use strict";function e(t){var e=[];return t?(u.each(t,function(t,r){var n=t.split(" "),i=n[0].replace(/,/g," "),a=n.slice(1).join(" "),o=r;"statechange"===i?(r=function(){var t=History.getState().data.query;o(t)},u.addEvent(window,i,r)):u.addEvent(d,i,a,r),e.push({name:i,selector:a,callback:r})}),e):e}function r(t){0!==t.length&&u.each(t,function(t,e){u.removeEvent(e.name,e.selector,e.callback)})}var n,i,a,o,s,u,c,l=Array.prototype,f=l.slice,h=l.isArray,p=l.forEach,g=l.indexOf,d=t.document||{},v=t.Sherpa||{Router:function(){}},m=t.Arg||{all:function(){}};n=function(){this.routes={},this.filters={}},"object"==typeof module&&"object"==typeof module.exports?module.exports=n:t.Doppelganger=n;var y={filters:["EventFilter","RouterFilter"],routes:{index:""}},E={routes:"routeManager",filters:"filterManager"};n.prototype={create:function(t){var e,r;this.options=u.extend({},y,t.options),this.filterManager=new n.FilterManager(this),this.routeManager=new n.RouteManager(this,t.rootUrl);for(var i in E)E.hasOwnProperty(i)&&(e=E[i],r=t[i]||this.options[i],this[e].add(t[i]));return this},init:function(){var t=this;History.Adapter.bind(window,"statechange",function(){var e=History.getState();e.data&&e.data.controllerStateChange||t.trigger(e.data.destination,e.data.params)}),this.startPage=this.routeManager.recognize(window.location.pathname),this.navigate()},navigate:function(){this.navigate=function(e,r){history.pushState?History.pushState({destination:e,params:r},d.title,this.routeManager.generate(e,r)):t.location=t.helpers.routing.generate(e,r)},this.startPage?this.filterManager.process(this.startPage):this.navigate(this.options.defaultRoute[0],this.options.defaultRoute[1])},trigger:function(t,e){this.filterManager.process({destination:t,params:e})},updateContent:function(t){var e=c(this.PAGE_CONTENT_SELECTOR);return e.append(t)}},n.util=u={getterSetterCreator:function(t){return function(e,r){var n=this[t];if("string"!=typeof e)u.isArray(n)?u.isArray(e)?n.concat(e):n.push(e):u.extend(n,e);else{if(!r)return n[e];n[e]=r}}},capitolize:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},extend:function(t){var e,r,n,i=f.call(arguments,1);for(r=0;i.length>r;r++)if(e=i[r])for(n in e)t[n]=e[n];return t},each:function(t,e,r){if(null!=t)if(p&&t.forEach===p)t.forEach(e,r);else if(t.length===+t.length){for(var n=0,i=t.length;i>n;n++)if(e.call(r,t[n],n,t)===!1)return}else for(var a in t)if(t.hasOwnProperty(a)&&e(t[a],a,t)===!1)break},isArray:h||function(t){return t&&"object"==typeof t&&"number"==typeof t.length&&"[object Array]"==""+t||!1},indexOf:function(t,e){if(null==t)return-1;var r=0,n=t.length;if(g&&t.indexOf===g)return t.indexOf(e);for(;n>r;r++)if(t[r]===e)return r;return-1},map:function(t,e){var r=-1,n=t?t.length:0,i=Array("number"==typeof n?n:0);if(u.isArray(t))for(;n>++r;)i[r]=e(t[r],r,t);else u.each(t,function(t,n,a){i[++r]=e(t,n,a)});return i},$:function(t){return d.querySelectorAll(t)},matchesSelector:function(t,e){var r,n;if(t.matchesSelector)return t.matchesSelector(e);if(!t.parentNode){r=d.createDocumentFragment(),r.appendChild(t),n=t.parentNode.querySelectorAll(e);for(var i=0,a=n.length;a>i;i++)if(n[i]===t)return!0;return!1}},addEvent:function(t,e,r,n){var i=n;if("function"==typeof r&&(n=function(t){var e=t.target||t.srcElement;u.matchesSelector(e,r)&&i.apply(this,arguments)}),t.addEventListener)t.addEventListener(e,n,!1);else{if(!t.attachEvent)throw Error("addEvent() was called in a context without event listener support");t.attachEvent("on"+e,n)}},removeEvent:function(t,e,r){return[t,e,r]}},c=u.$,n.RouteManager=s=function(t,e){this.app=t,this.router=new v.Router,this.baseUrl=e,this.routes={}},n.RouteManager.prototype={add:function(t){for(var e,r,n,i=t.length,a=0;i>a;a++)e=t[a],r=e.name,n=e.url,this.router.add(this.baseUrl+n,e).to(r).name(r);u.extend(this.router,e)},get:u.getterSetterCreator("routes"),recognize:function(t){return this.router.recognize(t)},generate:function(t,e){return this.router.generate(t,u.extend({},e))},trigger:function(t,e){return n.Routes[t].invoke(this.app,e)}},n.Routes={},n.Route=o=function(t,e){this.name=t,this.route=e,n.Routes[t]=this},o.prototype={invoke:function(t,e){this.route.call(t,e)}};var w=0;n.FilterManager=a=function(t){this.filters=[],this.app=t},n.FilterManager.prototype={add:u.getterSetterCreator("filters"),remove:function(t){var e=u.indexOf(t,this.filters);e!==!1&&(w>e&&(w-=1),this.filters.splice(e,1))},process:function(t){for(w=0;this.filters.length>w;w++){var e=this.filters[w];t=n.Filters[e].invoke(this.app,t)}}},n.Filters={},n.Filter=i=function(t,e){this.name=t,this.filter=e,n.Filters[t]=this},i.prototype={invoke:function(t,e){return this.filter.call(t,e)}},new i("RouterFilter",function(t){return!t.destination||!t.params,t.destination&&(t=u.extend(t,this.routeManager.trigger(t.destination,t))),t});var x=[];new i("EventFilter",function(t){return t.partial||r(x),x=x.concat(e(t.events)),t}),new i("QueryParamFilter",function(t){return t&&t.params||(t=c.extend(t,{params:m.all()})),t})})(this);