(function(t){"use strict";function e(t){return function(e,n){if("string"!=typeof e)s.extend(this[t],e);else{if(!n)return this[t][e];this[t][e]=n}}}function n(t){var e=[];return t?(s.each(t,function(t,n){var r=t.split(" "),i=r[0].replace(/,/g," "),o=r.slice(1).join(" "),a=n;"statechange"===i?(n=function(){var t=History.getState().data.query;a(t)},s.addEvent(window,i,n)):s.addEvent(d,i,o,n),e.push({name:i,selector:o,callback:n})}),e):e}function r(t){0!==t.length&&s.each(t,function(t,e){s.removeEvent(e.name,e.selector,e.callback)})}var i,o,a,s,u,c=Array.prototype,l=c.slice,f=c.isArray,h=c.forEach,p=c.indexOf,d=t.document||{},g=g||{Router:function(){}};i=function(){this.routes={},this.filters={}},"object"==typeof module&&"object"==typeof module.exports?module.exports=i:t.Doppelganger=i,i.prototype={create:function(t){for(var e in t)this["add"+s.capitolize(e)](t[e])},init:function(){s.addEvent(window,"statechange",function(){var e=History.getState();e.data&&e.data.controllerStateChange||t.trigger(e.data.destination,e.data.params)}),this.startPage=y.recognize(window.location.pathname)},addRoutes:e("routes"),addRoute:e("routes"),getRoute:e("routes"),addFilters:e("filters"),addFilter:e("filters"),getFilter:e("filters"),navigate:function(){t.navigate=function(e,n){history.pushState?History.pushState({destination:e,params:n},d.title,t.helpers.routing.generate(e,n)):t.location=t.helpers.routing.generate(e,n)},t.helpers.filterManager.process()},trigger:function(e,n){t.helpers.filterManager.process({destination:e,params:n})},updateContent:function(e){var n=u(this.PAGE_CONTENT_SELECTOR);return n.children().not("."+t.UMFlashMessage.messageClass).remove(),n.append(e)}},i.util=s={capitolize:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},extend:function(t){var e,n,r,i=l.call(arguments,1);for(n=0;i.length>n;n++)if(e=i[n])for(r in e)t[r]=e[r];return t},each:function(t,e,n){if(null!=t)if(h&&t.forEach===h)t.forEach(e,n);else if(t.length===+t.length){for(var r=0,i=t.length;i>r;r++)if(e.call(n,t[r],r,t)===!1)return}else for(var o in t)if(t.hasOwnProperty(o)&&e(t[o],o,t)===!1)break},isArray:f||function(t){return t&&"object"==typeof t&&"number"==typeof t.length&&"[object Array]"==""+t||!1},indexOf:function(t,e){if(null==t)return-1;var n=0,r=t.length;if(p&&t.indexOf===p)return t.indexOf(e);for(;r>n;n++)if(t[n]===e)return n;return-1},map:function(t,e){var n=-1,r=t?t.length:0,i=Array("number"==typeof r?r:0);if(s.isArray(t))for(;r>++n;)i[n]=e(t[n],n,t);else s.each(t,function(t,r,o){i[++n]=e(t,r,o)});return i},$:d.querySelectorAll,matchesSelector:function(t,e){var n,r;if(t.matchesSelector)return t.matchesSelector(e);if(!t.parentNode){n=d.createDocumentFragment(),n.appendChild(t),r=t.parentNode.querySelectorAll(e);for(var i=0,o=r.length;o>i;i++)if(r[i]===t)return!0;return!1}},addEvent:function(t,e,n,r){var i=r;if("function"==typeof n&&(r=function(t){var e=t.target||t.srcElement;s.matchesSelector(e,n)&&i.apply(this,arguments)}),t.addEventListener)t.addEventListener(e,r,!1);else{if(!t.attachEvent)throw Error("addEvent() was called in a context without event listener support");t.attachEvent("on"+e,r)}},removeEvent:function(t,e,n){return[t,e,n]}},u=s.$,i.Request=a=function(t){this.app=t},i.Request.prototype={setQueryParam:function(t,e){0===e.length?delete this.query[t]:this.query[t]=e},getQuery:function(){return this.query},setQuery:function(t){this.query=t},buildQueryString:function(){var t="";return u.each(this.getQuery(),function(e,n){t+=encodeURIComponent(e)+"="+encodeURIComponent(n),t+="&"}),t.length?"?"+t.slice(0,-1):t}},i.Router=function(t,e){this.router=new g.Router,this.baseUrl=t,this.options=s.extend({},e)},i.Router.prototype={recognize:function(t){return this.router.recognize(t)},generate:function(t,e){return this.router.generate(t,s.extend({},e))}};var v=0;i.FilterManager=function(){this.filters=[]},i.FilterManager.prototype={add:function(t){this.filters.push(t)},remove:function(t){var e=s.indexOf(t,this.filters);e!==!1&&(v>e&&(v-=1),this.filters.splice(e,1))},process:function(t){for(v=0;this.filters.length>v;v++)t=this.filters[v](t)}},i.Filters={},i.Filter=o=function(t,e){this.name=t,this.filter=e},o.prototype={apply:function(t,e){this.filter.call(t,e)}},i.Filters.LocationFilter=new o("Location",function(e){var n;e.location=n=t.location,n&&(e.search=t.location.search,e.pathName=t.location.pathname)}),i.Filters.QueryStringFilter=new o("QueryString",function(t){var e=t.search,n=e.slice(1).split("&"),r={};""!==e&&u.each(n,function(t,e){var n=e.split("=");r[n[0]]=n[1]}),t.setQuery(r)});var y=new i.Router;i.Filters.RouterFilter=new o("Router",function(e,n){return n&&n.destination&&n.params||(n=s.extend(!0,n,this.startPage)),n.destination?n=s.extend(n,t.helpers.routing.trigger(n.destination,n.params)):this.navigate.apply(t,t.DEFAULT_ROUTE),n});var m=[];i.Filters.EventFilter=new o("Event",function(t,e){return e&&(e.partial||r(m),m=m.concat(n(e.events))),e})})(this);