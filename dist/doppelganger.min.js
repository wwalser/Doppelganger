(function(t){"use strict";function e(t){var e=[];return t?(o.each(t,function(t,r){var n=t.split(" "),i=n[0].replace(/,/g," "),a=n.slice(1).join(" "),s=r;"statechange"===i?(r=function(){var t=History.getState().data.query;s(t)},o.addEvent(window,i,r)):o.addEvent(p,i,a,r),e.push({name:i,selector:a,callback:r})}),e):e}function r(t){0!==t.length&&o.each(t,function(t,e){o.removeEvent(e.name,e.selector,e.callback)})}var n,i,a,o,s,u=Array.prototype,c=u.slice,f=u.isArray,l=u.forEach,h=u.indexOf,p=t.document||{},d=d||{Router:function(){}};n=function(){this.routes={},this.filters={}},"object"==typeof module&&"object"==typeof module.exports?module.exports=n:t.Doppelganger=n;var g={routes:"router",filters:"filterManager"};n.prototype={create:function(t){var e;this.filterManager=new n.FilterManager(this),this.router=new n.Router(t.rootUrl,t.routerOptions);for(var r in g)g.hasOwnProperty(r)&&(e=g[r],this[e].add(t[r]))},init:function(){var t=this;o.addEvent(window,"statechange",function(){var e=History.getState();e.data&&e.data.controllerStateChange||t.trigger(e.data.destination,e.data.params)}),this.startPage=this.router.recognize(window.location.pathname),this.navigate()},navigate:function(){this.navigate=function(e,r){history.pushState?History.pushState({destination:e,params:r},p.title,this.router.generate(e,r)):t.location=t.helpers.routing.generate(e,r)},this.filterManager.process(this.startPage)},trigger:function(t,e){this.filterManager.process({destination:t,params:e})},updateContent:function(t){var e=s(this.PAGE_CONTENT_SELECTOR);return e.append(t)}},n.util=o={getterSetterCreator:function(t){return function(e,r){var n=this[t];if("string"!=typeof e)o.isArray(n)?o.isArray(e)?n.concat(e):n.push(e):o.extend(n,e);else{if(!r)return n[e];n[e]=r}}},capitolize:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},extend:function(t){var e,r,n,i=c.call(arguments,1);for(r=0;i.length>r;r++)if(e=i[r])for(n in e)t[n]=e[n];return t},each:function(t,e,r){if(null!=t)if(l&&t.forEach===l)t.forEach(e,r);else if(t.length===+t.length){for(var n=0,i=t.length;i>n;n++)if(e.call(r,t[n],n,t)===!1)return}else for(var a in t)if(t.hasOwnProperty(a)&&e(t[a],a,t)===!1)break},isArray:f||function(t){return t&&"object"==typeof t&&"number"==typeof t.length&&"[object Array]"==""+t||!1},indexOf:function(t,e){if(null==t)return-1;var r=0,n=t.length;if(h&&t.indexOf===h)return t.indexOf(e);for(;n>r;r++)if(t[r]===e)return r;return-1},map:function(t,e){var r=-1,n=t?t.length:0,i=Array("number"==typeof n?n:0);if(o.isArray(t))for(;n>++r;)i[r]=e(t[r],r,t);else o.each(t,function(t,n,a){i[++r]=e(t,n,a)});return i},$:p.querySelectorAll,matchesSelector:function(t,e){var r,n;if(t.matchesSelector)return t.matchesSelector(e);if(!t.parentNode){r=p.createDocumentFragment(),r.appendChild(t),n=t.parentNode.querySelectorAll(e);for(var i=0,a=n.length;a>i;i++)if(n[i]===t)return!0;return!1}},addEvent:function(t,e,r,n){var i=n;if("function"==typeof r&&(n=function(t){var e=t.target||t.srcElement;o.matchesSelector(e,r)&&i.apply(this,arguments)}),t.addEventListener)t.addEventListener(e,n,!1);else{if(!t.attachEvent)throw Error("addEvent() was called in a context without event listener support");t.attachEvent("on"+e,n)}},removeEvent:function(t,e,r){return[t,e,r]}},s=o.$,n.Router=a=function(t,e){this.router=new d.Router,this.baseUrl=t,this.options=o.extend({},e),this.routes={}},n.Router.prototype={add:o.getterSetterCreator("routes"),get:o.getterSetterCreator("routes"),recognize:function(t){return this.router.recognize(t)},generate:function(t,e){return this.router.generate(t,o.extend({},e))}};var v=0;n.FilterManager=function(t){this.filters=[],this.app=t},n.FilterManager.prototype={add:o.getterSetterCreator("filters"),remove:function(t){var e=o.indexOf(t,this.filters);e!==!1&&(v>e&&(v-=1),this.filters.splice(e,1))},process:function(t,e){for(v=0;this.filters.length>v;v++)e=this.filters[v].apply(this.app,e)}},n.Filters={},n.Filter=i=function(t,e){this.name=t,this.filter=e},i.prototype={apply:function(t,e){this.filter.call(t,e)}},n.Filters.RouterFilter=new i("Router",function(e){return!e.destination||!e.params,e.destination||this.navigate.apply(t,t.DEFAULT_ROUTE),e});var y=[];n.Filters.EventFilter=new i("Event",function(t){return t.partial||r(y),y=y.concat(e(t.events)),t})})(this);