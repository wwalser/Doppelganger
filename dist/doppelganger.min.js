(function(t){"use strict";function e(t){var e=[];return t?(o.each(t,function(t,r){var n,a=r.split(" "),i=a[0].split(","),s=a.slice(1).join(" "),l=t;o.each(i,function(r){"statechange"===r?(n=window,t=function(){var t=History.getState().data.query;l(t)},o.addEvent(n,r,t)):(n=d,o.addEvent(n,r,s,t)),e.push({name:r,selector:s,callback:t,elem:n})})}),e):e}function r(t){0!==t.length&&o.each(t,function(t){o.removeEvent(t.elem,t.name,t.selector,t.callback)})}var n;n=function(){this.routes={},this.filters={}},"object"==typeof module&&"object"==typeof module.exports?module.exports=n:t.Doppelganger=n;var a,i,o,s,l=Array.prototype,u=l.slice,c=l.isArray,f=l.forEach,h=l.indexOf,d=t.document||{},g={};n.util=o={getterSetterCreator:function(t){return function(e,r){var n=this[t];if("string"!=typeof e)o.isArray(n)?o.isArray(e)?l.push.apply(n,e):n.push(e):o.extend(n,e);else{if(!r)return n[e];n[e]=r}}},extend:function(t){var e,r,n,a=u.call(arguments,1);for(r=0;a.length>r;r++)if(e=a[r])for(n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},each:function(t,e,r){if(null!=t)if(f&&t.forEach===f)t.forEach(e,r);else if(t.length===+t.length){for(var n=0,a=t.length;a>n;n++)if(e.call(r,t[n],n,t)===!1)return}else for(var i in t)if(t.hasOwnProperty(i)&&e(t[i],i,t)===!1)break},isArray:c||function(t){return t&&"object"==typeof t&&"number"==typeof t.length&&"[object Array]"==""+t||!1},indexOf:function(t,e){if(null==t)return-1;var r=0,n=t.length;if(h&&t.indexOf===h)return t.indexOf(e);for(;n>r;r++)if(t[r]===e)return r;return-1},map:function(t,e){var r=-1,n=t?t.length:0,a=Array("number"==typeof n?n:0);if(o.isArray(t))for(;n>++r;)a[r]=e(t[r],r,t);else o.each(t,function(t,n,i){a[++r]=e(t,n,i)});return a},$:function(t){return d.querySelectorAll(t)},matchesSelector:function(t,e){var r,n;if(t.matches)return t.matches(e);if(!t.parentNode){if(t===d)return"document"===e;r=d.createDocumentFragment(),r.appendChild(t)}n=t.parentNode.querySelectorAll(e);for(var a=0,i=n.length;i>a;a++)if(n[a]===t)return!0;return!1},closest:function(t,e){for(var r=t,n=!1;null!=r&&!(n=o.matchesSelector(r,e));)r=r.parentNode;return n},addEvent:function(t,e,r,n){var a=n;if(n=n?function(t){var e=t.target||t.srcElement;o.closest(e,r)&&a.apply(this,arguments)}:r,t.addEventListener)t.addEventListener(e,n,!1);else{if(!t.attachEvent)throw Error("addEvent() was called in a context without event listener support");t.attachEvent("on"+e,n)}g[e]||(g[e]=[]),g[e].push({fn:a,boundFn:n,selector:"string"==typeof r?r:""})},removeEvent:function(t,e,r,n){for(var a,i,o=g[e],s=o?o.length:0,l=0;s>l;l++)if(a=o[l],n===a.fn&&r===a.selector){i=a.boundFn,o.splice(l,1);break}if(i)if(t.removeEventListener)t.removeEventListener(e,i);else{if(!t.detachEvent)throw Error("removeEvent() was called in a context without event listener support");t.detachEvent(e,i)}}},s=o.$;var p={rootUrl:"",routes:{name:"index",url:""},filters:["RouterFilter","EventFilter"]},v={routes:"routeManager",filters:"filterManager"};n.create=function(t){var e,r,a=new n;a.options=o.extend({},p,t),a.filterManager=new n.FilterManager(a),a.routeManager=new n.RouteManager(a,a.options.rootUrl);for(var i in v)v.hasOwnProperty(i)&&(e=v[i],r=a.options[i],a[e].add(r));return a},n.prototype={init:function(){var t=this;History.Adapter.bind(window,"statechange",function(){var e=History.getState();e.data.destination&&!e.data.controllerStateChange?t.trigger(e.data.destination,e.data.params):e.data.destination||t.trigger(t.startPage.destination,t.startPage.params)}),this.startPage=this.routeManager.recognize(window.location.pathname),this.navigate()},navigate:function(){this.navigate=function(e,r){history.pushState?History.pushState({destination:e,params:r},d.title,this.routeManager.generate(e,r)):t.location=t.helpers.routing.generate(e,r)},this.startPage?(this.startPage=o.extend({},this.startPage),this.startPage.params=o.extend(this.startPage.params,Arg.all()),this.trigger(this.startPage.destination,this.startPage.params)):this.navigate(this.options.defaultRoute[0],this.options.defaultRoute[1])},trigger:function(t,e){this.filterManager.process({destination:t,params:e})},updateContent:function(t){var e=s(this.PAGE_CONTENT_SELECTOR);return e.append(t)}},n.RouteHandlers={},n.setRouteHandler=o.getterSetterCreator("RouteHandlers"),n.getRouteHandler=o.getterSetterCreator("RouteHandlers"),n.FilterHandlers={},n.setFilterHandler=o.getterSetterCreator("FilterHandlers"),n.getFilterHandler=o.getterSetterCreator("FilterHandlers"),n.RouteManager=i=function(t,e){this.app=t,this.router=new Sherpa.Router,this.baseUrl=e,this.routes=[]},n.RouteManager.prototype={add:function(t){for(var e,r,n,a=t.length,i=0;a>i;i++)e=t[i],r=e.name,n=e.url,this.router.add(this.baseUrl+n,e).to(r).name(r);this.set(t)},set:o.getterSetterCreator("routes"),get:o.getterSetterCreator("routes"),recognize:function(t){return this.router.recognize(t)},generate:function(t,e){return this.router.generate(t,o.extend({},e))},trigger:function(t,e){return n.getRouteHandler(t).call(this.app,e)}};var m=0;n.FilterManager=a=function(t){this.filters=[],this.app=t},n.FilterManager.prototype={add:o.getterSetterCreator("filters"),remove:function(t){var e=o.indexOf(t,this.filters);e!==!1&&(m>e&&(m-=1),this.filters.splice(e,1))},process:function(t){for(m=0;this.filters.length>m;m++){var e=this.filters[m];t=n.getFilterHandler(e).call(this.app,t)}}},n.setFilterHandler("RouterFilter",function(t){return!t.destination||!t.params,t.destination&&(t=o.extend(t,this.routeManager.trigger(t.destination,t))),t});var y=[];n.setFilterHandler("EventFilter",function(t){return t.partial||r(y),y=y.concat(e(t.events)),t})})(this);